(function(m,t){"object"===typeof exports&&"undefined"!==typeof module?t(exports):"function"===typeof define&&define.amd?define(["exports"],t):t((m.THREE=m.THREE||{},m.THREE.Badminton=m.THREE.Badminton||{}))})(this,function(m){function t(a,b,c,d,e,f,g,h,l,k,T,n){THREE.Geometry.call(this);this.type="ShuttlecockGeometry";var p=(5*a*a+12*c*a+6*c*c)/(4*(2*a+3*c)),m=d/4*(a*a+2*b*a+3*b*b)/(a*a+b*a+b*b),x=void 0===n?a+c:(p*n+m)/(n+1),z=Math.atan((b-a)/(c+d)),B=a+m/d*(b-a);this.parameters={corkRadius:a,skirtRadius:b,
beltHeight:c,skirtHeight:d,widthSegments:e,heightSegments:f,rachisRadius:g,rachisRatio:h,featherWidth:l,featherRatio:k,featherAngle:T,massRatio:n,massCenter:x,corkMassCenter:p,skirtMassCenter:m,corkAngle:z,massToCorkTopLength:a/Math.tan(z),massToCorkCenterLength:x-p,skirtCrossSectionalArea:Math.PI*B*B};n=-a+x;p=new THREE.SphereGeometry(a,e,f,0,2*Math.PI,0,Math.PI/2);this.merge(p,(new THREE.Matrix4).compose(new THREE.Vector3(0,n,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,Math.PI/2,0,
"XYZ")),new THREE.Vector3(1,1,1)),0);n-=c/2;p=new THREE.CylinderGeometry(a,a,c,e,1,!0,0,2*Math.PI);this.merge(p,(new THREE.Matrix4).compose(new THREE.Vector3(0,n,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),1);n-=c/2;c=new THREE.CircleGeometry(a,e,0,2*Math.PI);this.merge(c,(new THREE.Matrix4).compose(new THREE.Vector3(0,n,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,-Math.PI/2,0,"YXZ")),new THREE.Vector3(1,1,1)),2);p=a-g;a=n-d*
h/(1+h);c=p+(b-p)*h/(1+h);m=new THREE.TorusGeometry(c,g,2*f,e,2*Math.PI);this.merge(m,(new THREE.Matrix4).compose(new THREE.Vector3(0,a,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,-Math.PI/2,0,"YXZ")),new THREE.Vector3(1,1,1)),3);m=(n+a)/2;f=new THREE.TorusGeometry((p+c)/2,g,2*f,e,2*Math.PI);this.merge(f,(new THREE.Matrix4).compose(new THREE.Vector3(0,m,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,-Math.PI/2,0,"YXZ")),new THREE.Vector3(1,1,1)),3);f=(p+b)/2;
b=-Math.atan((b-p)/d);p=d/Math.cos(b);d=n-d/2;g=new THREE.CylinderGeometry(g,g,p,e,1,!1,0,2*Math.PI);for(n=0;n<g.faces.length;n++)g.faces[n].materialIndex=0;n=1/(1+h)*p;h=new THREE.Geometry;h.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(l,k/(1+k)*-n,0),new THREE.Vector3(-l,k/(1+k)*-n,0),new THREE.Vector3(0,-n,0));h.faces.push(new THREE.Face3(0,2,3),new THREE.Face3(0,3,1));h.faceVertexUvs[0].push([new THREE.Vector2(0,1),new THREE.Vector2(0,0),new THREE.Vector2(1,0)],[new THREE.Vector2(1,
1),new THREE.Vector2(0,0),new THREE.Vector2(1,0)]);h.computeFaceNormals();h.computeVertexNormals();for(n=0;n<e;n++)k=2*Math.PI/e*n,p=Math.sin(k)*f,m=Math.cos(k)*f,l=new THREE.Euler(b,k,0,"YXZ"),this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(p,d,m),(new THREE.Quaternion).setFromEuler(l),new THREE.Vector3(1,1,1)),3),p=Math.sin(k)*c,k=Math.cos(k)*c,l=(new THREE.Matrix4).makeRotationFromEuler(l).multiply((new THREE.Matrix4).makeRotationY(T)),this.merge(h,(new THREE.Matrix4).compose(new THREE.Vector3(p,
a,k),(new THREE.Quaternion).setFromRotationMatrix(l),new THREE.Vector3(1,1,1)),4)}function A(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);this.type="HyperbolaGeometry";d=void 0!==d?d:8;e=void 0!==e?e:8;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;this.parameters={outerRadius:a,innerRadius:b,height:c,radiusSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var l=2*a,l=c/2*b/Math.sqrt(l/2*(l/2)-b*b),k=c/e;h/=d;var m=1/d,n=1/e,p=-c/2;c/=2;for(var v=0,x=p,z=0;v<e;v++,x+=
k,z+=n)for(var B=z+n,D=x+k,t=b*Math.sqrt(x*x+l*l)/l,w=b*Math.sqrt(D*D+l*l)/l,y=0,q=g,C=0;y<d;y++,q+=h,C+=m){var A=C+m,u=q+h,r=this.vertices.length;this.vertices.push(new THREE.Vector3(Math.sin(q)*t,x,Math.cos(q)*t),new THREE.Vector3(Math.sin(u)*t,x,Math.cos(u)*t),new THREE.Vector3(Math.sin(q)*w,D,Math.cos(q)*w),new THREE.Vector3(Math.sin(u)*w,D,Math.cos(u)*w));this.faces.push(new THREE.Face3(r+0,r+3,r+2),new THREE.Face3(r+0,r+1,r+3));this.faceVertexUvs[0].push([new THREE.Vector2(C,z),new THREE.Vector2(A,
B),new THREE.Vector2(C,B)],[new THREE.Vector2(C,z),new THREE.Vector2(A,z),new THREE.Vector2(A,B)])}if(!f)for(v=0,q=g;v<d;v++,q+=h)u=q+h,r=this.vertices.length,this.vertices.push(new THREE.Vector3(0,c,0),new THREE.Vector3(Math.sin(q)*a,c,Math.cos(q)*a),new THREE.Vector3(Math.sin(u)*a,c,Math.cos(u)*a)),this.faces.push(new THREE.Face3(r+0,r+1,r+2,null,null,1)),this.faceVertexUvs[0].push([new THREE.Vector2(.5,.5),new THREE.Vector2(.5+.5*Math.cos(q),.5+.5*Math.sin(q)),new THREE.Vector2(.5+.5*Math.cos(u),
.5+.5*Math.sin(u))]),r+=3,this.vertices.push(new THREE.Vector3(0,p,0),new THREE.Vector3(Math.sin(q)*a,p,Math.cos(q)*a),new THREE.Vector3(Math.sin(u)*a,p,Math.cos(u)*a)),this.faces.push(new THREE.Face3(r+0,r+2,r+1,null,null,2)),this.faceVertexUvs[0].push([new THREE.Vector2(.5,.5),new THREE.Vector2(.5+.5*Math.cos(u),.5-.5*Math.sin(u)),new THREE.Vector2(.5+.5*Math.cos(q),.5-.5*Math.sin(q))]);this.computeFaceNormals();this.computeVertexNormals()}function E(a,b,c,d,e,f){THREE.Geometry.call(this);this.type=
"NetGeometry";d=void 0!==d?d:c;e=void 0!==e?e:1;f=void 0!==f?f:1;this.parameters={width:a,height:b,outerTube:c,innerTube:d,widthSegments:e,heightSegments:f};var g=new THREE.PlaneGeometry(c,b),h=new THREE.PlaneGeometry(a,c);this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(-a/2+c/2,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(a/2-c/2,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,
0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);this.merge(h,(new THREE.Matrix4).compose(new THREE.Vector3(0,b/2-c/2,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);this.merge(h,(new THREE.Matrix4).compose(new THREE.Vector3(0,-b/2+c/2,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);var h=new THREE.PlaneGeometry(d,b),g=new THREE.PlaneGeometry(a,d),l=(a-2*c-d*(e-1))/e,k=-a/2+c+l+d/2;for(a=0;a<e-1;a++,k+=l+d)this.merge(h,
(new THREE.Matrix4).compose(new THREE.Vector3(k,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),1);e=(b-2*c-d*(f-1))/f;b=-b/2+c+e+d/2;for(a=0;a<f-1;a++,b+=e+d)this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(0,b,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),1)}function F(a,b,c,d,e,f){THREE.Geometry.call(this);this.type="CourtGeometry";this.parameters={shortLine:a,longLineSingle:b,longLineDouble:c,
sidelineSingle:d,sidelineDouble:e,lineWidth:f};for(var g=new THREE.PlaneGeometry(f,2*e),h=[a+f/2,c-f/2,b-f/2],l=0;l<h.length;l++)for(c=-1;1>=c;c+=2)this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(h[l]*c,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(0,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);g=new THREE.PlaneGeometry(2*
b,f);d=[d-f/2,e-f/2];for(l=0;l<d.length;l++)for(c=-1;1>=c;c+=2)this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(0,d[l]*c,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);f=new THREE.PlaneGeometry(b-a,f);for(c=-1;1>=c;c+=2)this.merge(f,(new THREE.Matrix4).compose(new THREE.Vector3((a+b)/2*c,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0)}function G(a,b,c,d,e,f,g,h){THREE.Geometry.call(this);
this.type="RacketGeometry";g=void 0!==g?g:16;h=void 0!==h?h:16;this.parameters={width:a,height:b,tube:c,lineWidth:d,widthSegments:e,heightSegments:f,radialSegments:g,tubularSegments:h};a=a/2-c;b=b/2-c;for(var l=g*h,k=0;k<g;k++)for(var m=0;m<h;m++){var n=k/h*Math.PI*2,p=m/g*Math.PI*2,v=this.vertices.length;this.vertices.push(new THREE.Vector3((a+c*Math.cos(p))*Math.cos(n),(b+c*Math.cos(p))*Math.sin(n),c*Math.sin(p)));n=v+0;v+=1;m===h-1&&(v-=h);p=(v+h)%l;this.faces.push(new THREE.Face3(n,(n+h)%l,p),
new THREE.Face3(n,p,v));this.faceVertexUvs[0].push([new THREE.Vector2(0,1),new THREE.Vector2(0,0),new THREE.Vector2(1,0)],[new THREE.Vector2(1,1),new THREE.Vector2(0,0),new THREE.Vector2(1,0)])}h=2*(a-c);g=d+(h-d*(e-1))/e;k=0;for(h=-h/2-d/2+g;k<e-1;k++,h+=g)l=new THREE.PlaneGeometry(d,2*b*Math.sin(Math.acos(h/a))),this.merge(l,(new THREE.Matrix4).compose(new THREE.Vector3(h,0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),1);e=2*(b-c);c=d+(e-d*(f-1))/
f;k=0;for(e=-e/2-d/2+c;k<f-1;k++,e+=c)g=new THREE.PlaneGeometry(2*a*Math.cos(Math.asin(e/b)),d),this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(0,e,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),1);this.computeFaceNormals();this.computeVertexNormals()}function H(a,b,c){THREE.Geometry.call(this);this.type="ScoreboardGeometry";var d=Math.atan(c/2/b),e=Math.sqrt(Math.pow(c/2,2)+Math.pow(b,2));this.parameters={width:a,height:b,depth:c,planeAngle:d,
planeHeight:e};var f=new THREE.PlaneGeometry(a,e);this.merge(f,(new THREE.Matrix4).compose(new THREE.Vector3(0,b/2,c/4),(new THREE.Quaternion).setFromEuler(new THREE.Euler(-d,0,0,"XYZ")),new THREE.Vector3(1,1,1)),0);e=new THREE.PlaneGeometry(a,e);this.merge(e,(new THREE.Matrix4).compose(new THREE.Vector3(0,b/2,-c/4),(new THREE.Quaternion).setFromEuler(new THREE.Euler(d,Math.PI,0,"XYZ")),new THREE.Vector3(1,1,1)),1);a=new THREE.PlaneGeometry(a,c);this.merge(a,(new THREE.Matrix4).compose(new THREE.Vector3(0,
0,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,0,0,"XYZ")),new THREE.Vector3(1,1,1)),2)}function I(a,b,c,d){THREE.Geometry.call(this);this.type="ArrowGeometry";c=void 0!==c?c:1;d=void 0!==d?d:1;this.parameters={width:a,height:b,widthRatio:c,heightRatio:d};a/=2;var e=b/2;b*=d/(d+1);c=1/(c+1)*a;this.vertices.push(new THREE.Vector3(0,e,0),new THREE.Vector3(-a,e-b,0),new THREE.Vector3(a,e-b,0),new THREE.Vector3(-c,e-b,0),new THREE.Vector3(c,e-b,0),new THREE.Vector3(-c,-e,0),new THREE.Vector3(c,
-e,0));this.faces.push(new THREE.Face3(0,1,2),new THREE.Face3(6,4,3),new THREE.Face3(3,5,6));this.computeFaceNormals();this.computeVertexNormals()}function J(a){var b={},c;for(c in a)b[c]=a[c];b.uniforms={texture:{value:a.map},size:{value:a.size},pixelSize:{value:a.pixelSize}};b.vertexShader="varying vec2 vUv;\r\nvoid main() {\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\tvUv = uv;\r\n}";b.fragmentShader="uniform sampler2D texture;\r\nuniform vec2 size;\r\nuniform vec2 pixelSize;\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n\t\r\n\tvec2 pixelRatio = pixelSize / size;\r\n\tgl_FragColor = vec4(texture2D(texture, pixelRatio * floor(vUv / pixelRatio)).rgb, 1.0); \r\n}";
delete b.map;delete b.size;delete b.pixelSize;THREE.ShaderMaterial.call(this,b)}function w(a){a=a||{};var b={},c;for(c in a)b[c]=a[c];b.uniforms={numbers:{},boxMin:{value:a.boxMin||new THREE.Vector2(.2,.2)},boxMax:{value:a.boxMax||new THREE.Vector2(.8,.8)},lineSize:{value:a.lineSize||new THREE.Vector2(.1,.1)},numberColor:{value:a.numberColor&&new THREE.Color(a.numberColor)||new THREE.Vector3(0,0,0)},backgroundColor:{value:a.backgroundColor&&new THREE.Color(a.backgroundColor)||new THREE.Vector3(1,
1,1)}};b.vertexShader="varying vec2 vUv;\r\nvoid main() {\r\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r\n\tvUv = uv;\r\n}";void 0!==a.number?this.setNumber(a.number,b):this.setNumbers(a.numbers,b);delete b.number;delete b.numbers;delete b.boxMin;delete b.boxMax;delete b.lineSize;delete b.numberColor;delete b.backgroundColor;THREE.ShaderMaterial.call(this,b)}function L(a,b,c,d){THREE.Object3D.call(this);this.parameters={mass:c+d,corkMass:c,skirtMass:d};c=new THREE.Object3D;
this.add(c);a=new THREE.Mesh(a,b);c.add(a);this.flipFrame=c;this.mesh=a;this.dragCoefficient=.44;this.airDensity=1.1839;this.gravity=new THREE.Vector3(0,-9.8,0);this.toppleVelocity=100;this.toppleAngularVelocity=3*Math.PI;this.mesh.geometry.boundingSphere||this.mesh.geometry.computeBoundingSphere();this.groundAttenuation=.8;this.groundElapsed=0;this.groundElapsedDelta=.5;this.init()}function M(a,b){function c(a){for(var c=new THREE.Object3D,d=c,e=0;e<a.length;e++){var f=a[e],k=String.fromCharCode("A".charCodeAt()+
e),l=new THREE.Object3D;d.add(l);c["axis"+k]=f;c["frame"+k]=l;(function(a,b){var d=0;Object.defineProperty(c,"angle"+k,{get:function(){return d},set:function(c){d=c;a.quaternion.setFromAxisAngle(b,c)}})})(l,f);d=l}a=b.clone();a.position.set(-h.x,-h.y+g.y/2,-h.z);d.add(a);c.racket=a;return c}THREE.Object3D.call(this);var d=(new THREE.Box3).setFromLocalObject(a),e=d.getSize(),d=d.getCenter(),f=(new THREE.Box3).setFromLocalObject(b),g=f.getSize(),h=f.getCenter();this.parameters={bodySize:e,bodyCenter:d,
racketSize:g,racketCenter:h};f=a.clone();f.position.set(-d.x,-d.y+e.y/2,-d.z);this.add(f);var l=c([new THREE.Vector3(1,0,0),new THREE.Vector3(-1,0,0)]);l.position.set(d.x,d.y+e.y/2,d.z);f.add(l);var k=c([new THREE.Vector3(0,-1,0),new THREE.Vector3(-1,0,0)]);k.rotation.z=-Math.PI/2;k.position.set(d.x+e.x/2,d.y,d.z);f.add(k);var m=c([new THREE.Vector3(0,1,0),new THREE.Vector3(-1,0,0)]);m.rotation.z=Math.PI/2;m.position.set(d.x-e.x/2,d.y,d.z);f.add(m);this.body=f;this.links=[this.topLink=l,this.leftLink=
k,this.rightLink=m];this.topImpactAngle=-Math.PI/15;this.smashSpeed=100*Math.PI;this.defaultImpactType="right";this.targetPosition=new THREE.Vector3(0,0,0);this.impactDelta=1;this.responsibleArea=new THREE.Box3(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0));this.shuttlecock=null;this.racketAttenuation=.9;this.bodySpeed=1E3;this.bodyAngularSpeed=2*Math.PI;this.linkAngularSpeed=2*Math.PI;this.netHeight=1.55;this.netHeightDelta=.2;this.healthPercentDecrease=function(a){return.001*a};this.healthPercentDecreaseMax=
function(){return 10};this.healthPercentIncrease=function(a){return 1*a};this.healthPercentIncreaseMax=function(){return 2/3*(100-this.healthPercent)};this.readyPosition=null;this.init()}function N(a,b){THREE.Mesh.call(this,a,b)}function y(a,b){THREE.Mesh.call(this,a,b)}function O(a,b){THREE.Mesh.call(this,a,b);this.actions=[];this.frontCards=[];this.backCards=[];this.transitionCards=[];this.speed=2*Math.PI}function P(a,b){THREE.Object3D.call(this);var c=(new THREE.Box3).setFromLocalObject(a),d=c.getSize(),
e=c.getCenter(),f=(new THREE.Box3).setFromLocalObject(b),c=f.getSize(),g=f.getCenter();this.parameters={netSize:d,netCenter:e,postSize:c,postCenter:g};f=a.clone();f.position.set(-e.x,-e.y+c.y-d.y/2,-e.z);this.add(f);e=b.clone();e.position.set(-g.z-c.z/2-d.x/2,-g.y+c.y/2,-g.x);e.rotation.y=Math.PI/2;this.add(e);d=e.clone();d.position.x*=-1;d.rotation.y*=-1;this.add(d);this.net=f;this.postLeft=e;this.postRight=d}function Q(a){this.init(a)}function R(a,b,c,d){this.shuttlecock=a;this.robot1=b;this.robot2=
c;this.init(d)}function K(a){this.audio=a;var b=new (this.constructor.support());a=b.createMediaElementSource(a);var c=b.createGain(),d=b.createGain(),e=b.createChannelSplitter(2),f=b.createChannelMerger(2);a.connect(e);e.connect(c,0);e.connect(d,1);c.connect(f,0,0);d.connect(f,0,1);f.connect(b.destination);this.leftGain=c;this.rightGain=d;this._rightVolume=this._leftVolume=this._volume=1;this.updateVolume()}function S(a){this.localStorage=a;this.separaor=",";this.namespace="three.badminton.js::ranking";
this.maxCount=Infinity}window.performance=window.performance||Date;void 0===THREE.Object3D.prototype.localToTarget&&(THREE.Object3D.prototype.localToTarget=function(a,b,c){if(a instanceof THREE.Vector3)switch(c){case "direction":return this.localToTarget(a,b).sub(this.localToTarget(new THREE.Vector3(0,0,0),b));default:return b.worldToLocal(this.localToWorld(a))}else if(a instanceof THREE.Box3)return c=this.localToTarget(a.min.clone(),b),b=this.localToTarget(a.max.clone(),b),a.setFromPoints([c,b])});
void 0===THREE.Box3.prototype.setFromLocalObject&&(THREE.Box3.prototype.setFromLocalObject=function(a){var b=(new THREE.Box3).setFromObject(a),c=a.worldToLocal(b.min);a=a.worldToLocal(b.max);return this.setFromPoints([c,a])});void 0===THREE.Box3.prototype.fromArray&&(THREE.Box3.prototype.fromArray=function(a){this.setFromArray(a);return this});void 0===THREE.Box3.prototype.toArray&&(THREE.Box3.prototype.toArray=function(){return this.min.toArray().concat(this.max.toArray())});t.prototype=Object.create(THREE.Geometry.prototype);
t.prototype.constructor=t;A.prototype=Object.create(THREE.Geometry.prototype);A.prototype.constructor=A;E.prototype=Object.create(THREE.Geometry.prototype);E.prototype.constructor=E;F.prototype=Object.create(THREE.Geometry.prototype);F.prototype.constructor=F;G.prototype=Object.create(THREE.Geometry.prototype);G.prototype.constructor=G;H.prototype=Object.create(THREE.Geometry.prototype);H.prototype.constructor=H;I.prototype=Object.create(THREE.Geometry.prototype);I.prototype.constructor=I;J.prototype=
Object.create(THREE.ShaderMaterial.prototype);J.prototype.constructor=J;w.prototype=Object.assign(Object.create(THREE.ShaderMaterial.prototype),{constructor:w,setNumber:function(a,b){var c=a,d=[];do d.unshift(c%10),c=Math.floor(c/10);while(0<c);this.setNumbers(d,b)},setNumbers:function(a,b){b=b||this;b.uniforms.numbers.value=a;this.numberCount!==a.length&&(this.numberCount=a.length,b.fragmentShader="#define NUMBER_COUNT "+this.numberCount+"\nvarying vec2 vUv;\r\nuniform int numbers[NUMBER_COUNT];\r\nuniform vec2 boxMin;\r\nuniform vec2 boxMax;\r\nuniform vec2 lineSize;\r\nuniform vec3 numberColor;\r\nuniform vec3 backgroundColor;\r\nint getNum(int index) {\r\n\tfor (int i = 0; i < NUMBER_COUNT; i++)\r\n\t\tif (i == index)\r\n\t\t\treturn numbers[i];\r\n\treturn -1;\r\n}\r\nmat3 getMask(int num) {\r\n\tif (num == 0)\r\n\t\treturn mat3(1, 1, 1, 1, 1, 1, 0, 0, 0);\r\n\tif (num == 1)\r\n\t\treturn mat3(0, 0, 0, 0, 0, 0, 0, 1, 1);\r\n\tif (num == 2)\r\n\t\treturn mat3(1, 1, 0, 1, 1, 0, 1, 0, 0);\r\n\tif (num == 3)\r\n\t\treturn mat3(1, 1, 1, 1, 0, 0, 1, 0, 0);\r\n\tif (num == 4)\r\n\t\treturn mat3(0, 1, 1, 0, 0, 1, 1, 0, 0);\r\n\tif (num == 5)\r\n\t\treturn mat3(1, 0, 1, 1, 0, 1, 1, 0, 0);\r\n\tif (num == 6)\r\n\t\treturn mat3(1, 0, 1, 1, 1, 1, 1, 0, 0);\r\n\tif (num == 7)\r\n\t\treturn mat3(1, 1, 1, 0, 0, 0, 0, 0, 0);\r\n\tif (num == 8)\r\n\t\treturn mat3(1, 1, 1, 1, 1, 1, 1, 0, 0);\r\n\tif (num == 9)\r\n\t\treturn mat3(1, 1, 1, 1, 0, 1, 1, 0, 0);\r\n\treturn mat3(0);\r\n}\r\nbool isInside(vec2 start, vec2 size, float minX, float maxX, float minY, float maxY, vec2 line) {\r\n\treturn (vUv.x >= start.x + size.x * minX - line.x / 2.0 && vUv.x <= start.x + size.x * maxX + line.x / 2.0 &&\r\n\t\t\tvUv.y >= start.y + size.y * minY - line.y / 2.0 && vUv.y <= start.y + size.y * maxY + line.y / 2.0);\r\n}\r\nvoid main() {\r\n\t\r\n\tfloat width = 1.0 / float(NUMBER_COUNT);\r\n\tfloat numberIndex = floor(vUv.x / width);\r\n\t\r\n\tvec2 boxStart = vec2(width * numberIndex, 0.0);\r\n\tvec2 boxSize = vec2(width, 1.0);\r\n\t\r\n\tvec2 boxMid = (boxMin + boxMax) / 2.0;\r\n\tvec2 line = lineSize * boxSize;\r\n\t\r\n\tmat3 mask = getMask(getNum(int(numberIndex)));\r\n\t\r\n\tif ((mask[0][0] == 1.0 && isInside(boxStart, boxSize, boxMin.x, boxMax.x, boxMax.y, boxMax.y, line)) ||\r\n\t\t(mask[0][1] == 1.0 && isInside(boxStart, boxSize, boxMax.x, boxMax.x, boxMid.y, boxMax.y, line)) ||\r\n\t\t(mask[0][2] == 1.0 && isInside(boxStart, boxSize, boxMax.x, boxMax.x, boxMin.y, boxMid.y, line)) ||\r\n\t\t(mask[1][0] == 1.0 && isInside(boxStart, boxSize, boxMin.x, boxMax.x, boxMin.y, boxMin.y, line)) ||\r\n\t\t(mask[1][1] == 1.0 && isInside(boxStart, boxSize, boxMin.x, boxMin.x, boxMin.y, boxMid.y, line)) ||\r\n\t\t(mask[1][2] == 1.0 && isInside(boxStart, boxSize, boxMin.x, boxMin.x, boxMid.y, boxMax.y, line)) ||\r\n\t\t(mask[2][0] == 1.0 && isInside(boxStart, boxSize, boxMin.x, boxMax.x, boxMid.y, boxMid.y, line)) ||\r\n\t\t(mask[2][1] == 1.0 && isInside(boxStart, boxSize, boxMid.x, boxMid.x, boxMin.y, boxMid.y, line)) ||\r\n\t\t(mask[2][2] == 1.0 && isInside(boxStart, boxSize, boxMid.x, boxMid.x, boxMid.y, boxMax.y, line)))\r\n\t\tgl_FragColor = vec4(numberColor, 1.0);\r\n\telse\r\n\t\tgl_FragColor = vec4(backgroundColor, 1.0);\r\n}",
this.needsUpdate=!0)},getNumber:function(){for(var a=0,b=this.getNumbers(),c=0;c<b.length;c++)a=10*a+b[c];return a},getNumbers:function(){return this.uniforms.numbers.value}});L.prototype=Object.defineProperties(Object.assign(Object.create(THREE.Object3D.prototype),{constructor:L,getStates:function(){return this.state.split(" ")},hasState:function(a){return-1!==this.getStates().indexOf(a)},addState:function(a){this.hasState(a)||(this.state+=" "+a)},replaceState:function(a,b){var c=this.getStates(),
d=c.indexOf(a);-1!==d&&(c[d]=b);this.state=c.join(" ")},init:function(){this.state="active";this.flipFrame.rotation.set(0,0,0);this.velocity=new THREE.Vector3(0,0,0);this.flipAngularVelocity=this.flipAngle=0;this.flipAxis=new THREE.Vector3(0,0,0);this.impactCount=this.lastDelta=0},getYAxis:function(){this.flipFrame.updateMatrixWorld();return this.flipFrame.localToTarget(new THREE.Vector3(0,1,0),this.parent,"direction").normalize()},impact:function(a,b,c,d){this.velocity.reflect(b).multiplyScalar(1-
c).add(a);var e=this.getYAxis();this.updateActive(0);this.updateMatrixWorld();var f=this.parent.localToTarget(this.velocity.clone().cross(e),this,"direction").normalize();this.flipAngle=e=this.velocity.angleTo(e);this.flipAngularVelocity=0;this.flipAxis=f;f=(new THREE.Matrix4).makeRotationAxis(f,e);this.flipFrame.rotation.setFromRotationMatrix(f);!0!==d&&this.impactCount++;this.onAfterImpact.apply(this,arguments)},update:function(a){this.hasState("active")?this.updateActive(a):this.hasState("toppling")&&
this.updateToppling(a);this.lastDelta=a},updateActive:function(a){var b=this.airDensity,c=this.geometry.parameters.skirtCrossSectionalArea,d=this.dragCoefficient,e=this.velocity.length(),b=b*c*d*e*e/2,b=this.velocity.clone().normalize().multiplyScalar(-b),b=this.gravity.clone().multiplyScalar(this.parameters.mass).add(b);this.velocity.addScaledVector(b,a/this.parameters.mass);this.position.addScaledVector(this.velocity,a);b=this.velocity.clone().cross(this.gravity).normalize();0<b.length()&&(c=this.velocity.clone().normalize(),
d=b.clone().cross(c).normalize(),b=(new THREE.Matrix4).makeBasis(b,c,d),this.rotation.setFromRotationMatrix(b));0<a&&(b=[this.flipAngle,this.flipAngularVelocity],this.solveODE(b,this.flipDerivative,a),this.flipAngle=b[0],this.flipAngularVelocity=b[1],Math.abs(this.flipAngle)<Math.PI?(b=(new THREE.Matrix4).makeRotationAxis(this.flipAxis,this.flipAngle),this.flipFrame.rotation.setFromRotationMatrix(b)):this.flipFrame.rotation.set(0,0,0),this.updateMatrixWorld(),this.groundElapsed+=a,a=this.mesh.localToTarget(this.mesh.geometry.boundingSphere.center.clone(),
this.parent).y,b=this.mesh.geometry.boundingSphere.radius,a<b&&(this.groundElapsed>this.groundElapsedDelta&&(this.groundElapsed=0,this.impact(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0),this.groundAttenuation,!0)),a+this.velocity.y*this.groundElapsedDelta<b&&this.replaceState("active","toppling")))},updateToppling:function(a){this.rotation.setFromRotationMatrix((new THREE.Matrix4).makeRotationFromEuler(this.rotation).multiply((new THREE.Matrix4).makeRotationFromEuler(this.flipFrame.rotation)));
this.flipFrame.rotation.set(0,0,0);this.flipAngle=0;var b=new THREE.Vector3(0,1,0),c=this.parent.localToTarget(this.velocity.clone().setY(0).normalize().setY(-Math.tan(this.geometry.parameters.corkAngle)),this,"direction").normalize(),d=b.clone().cross(c).normalize(),b=Math.min(this.toppleAngularVelocity*a,b.angleTo(c));this.rotateOnAxis(d,b);d=this.localToTarget(new THREE.Vector3(0,this.geometry.parameters.massToCorkTopLength,0),this.parent).y;this.position.y-=Math.sign(d)*Math.min(Math.abs(d),this.toppleVelocity*
a);.05>Math.abs(b)&&.1>Math.abs(d)&&this.replaceState("toppling","toppled")},flipDerivative:function(a){var b=a[0];a=a[1];var c=this.airDensity,d=this.dragCoefficient,e=this.velocity.length(),f=this.parameters.skirtMass,g=this.parameters.corkMass,h=this.geometry.parameters.skirtCrossSectionalArea;return[a,-(c*h*d*e)/(2*f*(1+f/g))*a-c*h*d*e*e/(2*(g+f)*this.geometry.parameters.massToCorkCenterLength)*Math.sin(b)]},solveODE:function(a,b,c){for(var d=a.slice(0),d=b.call(this,d),e=a.slice(0),f=0;f<a.length;f++)e[f]+=
c/2*d[f];for(var e=b.call(this,e),g=a.slice(0),f=0;f<a.length;f++)g[f]+=c/2*e[f];for(var g=b.call(this,g),h=a.slice(0),f=0;f<a.length;f++)h[f]+=g[f]*c;b=b.call(this,h);for(f=0;f<a.length;f++)a[f]+=(d[f]+2*e[f]+2*g[f]+b[f])/6*c;return a},copy:function(a){THREE.Object3D.prototype.copy.call(this,a,!1);this.state=a.state;this.flipFrame.rotation.copy(a.flipFrame.rotation);this.velocity.copy(a.velocity);this.flipAngle=a.flipAngle;this.flipAngularVelocity=a.flipAngularVelocity;this.flipAxis.copy(a.flipAxis);
this.lastDelta=a.lastDelta;this.impactCount=a.impactCount;this.dragCoefficient=a.dragCoefficient;this.airDensity=a.airDensity;this.gravity.copy(a.gravity);this.toppleAngularVelocity=a.toppleAngularVelocity;return this},clone:function(){return(new this.constructor(this.geometry,this.material,this.parameters.corkMass,this.parameters.skirtMass)).copy(this)},onAfterImpact:function(){}}),{geometry:{get:function(){return this.mesh.geometry},set:function(a){this.mesh.geometry=a}},material:{get:function(){return this.mesh.material},
set:function(a){this.mesh.material=a}}});M.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:M,init:function(){this.impactType=this.defaultImpactType;this.impactCount=0;this.impactElapsed=this.impactDelta;this.healthPercent=100;this.topLink.angleA=this.topLink.angleB=0;this.leftLink.angleA=this.leftLink.angleB=0;this.rightLink.angleA=this.rightLink.angleB=0},setResponsibleArea:function(a,b){this.responsibleArea=a;b&&this.position.copy(a.min.clone().add(a.max).divideScalar(2))},
predictFallingTime:function(a){return(a-this.shuttlecock.position.y)/this.shuttlecock.velocity.y},predictFallingPosition:function(a){var b=this.predictFallingTime(a);return-.01>b?null:this.shuttlecock.position.clone().addScaledVector(this.shuttlecock.velocity,b).setY(a)},getRacketImpactLength:function(){return this.parameters.racketSize.y/2-this.parameters.racketCenter.y},getRacketImpactPosition:function(a,b){return a.localToTarget((new THREE.Vector3(0,this.getRacketImpactLength(),0)).applyAxisAngle(a.axisA,
b),this)},getImpactParams:function(){switch(this.impactType){case "top":return this.getImpactParamsTop();case "left":return this.getImpactParamsBottom(this.leftLink);case "right":return this.getImpactParamsBottom(this.rightLink);case "smash":return this.getImpactParamsSmash()}},getImpactParamsTop:function(){var a=this.topLink,b=this.topImpactAngle,c=this.getRacketImpactPosition(a,b),d=this.getTopImpactSpeed(c.y),e=this.predictFallingPosition(c.y);return{link:a,angle:b,speed:d,position:e,racketPosition:c}},
getImpactParamsBottom:function(a){var b=this.getRacketImpactPosition(a,0),c=this.getImpactAngleAndSpeed(b.y),d=c[0],c=c[1],e=this.predictFallingPosition(b.y);return{link:a,angle:d,speed:c,position:e,racketPosition:b}},getImpactParamsSmash:function(){var a=this.targetPosition,b=new THREE.Vector3(0,this.netHeight+this.netHeightDelta,1),c=new THREE.Vector3(0,this.netHeight+this.netHeightDelta,-1),b=b.clone().sub(a),c=c.clone().sub(a),c=b.clone().cross(c),b=this.shuttlecock.velocity,d=this.shuttlecock.position,
c=a.clone().sub(d).dot(c)/b.clone().dot(c),e=b.clone().multiplyScalar(c).add(d),b=this.topLink,a=Math.PI/2-e.clone().sub(a).angleTo(new THREE.Vector3(0,1,0)),d=this.smashSpeed,c=-1E4<c?e:null,e=this.getRacketImpactPosition(b,a);return{link:b,angle:a,speed:d,position:c,racketPosition:e}},update:function(a){this.onBeforeUpdate();for(var b=this.getImpactParams(),c=b.link,d=b.speed,e=b.position,f=b.racketPosition,g=0;g<this.links.length;g++)this.links[g]!==c&&(this.links[g].angleA=this.links[g].angleB=
0);var h=g=0,l=0,k=this.readyPosition||this.responsibleArea.getCenter();(0===this.impactCount||this.impactCount+2===this.shuttlecock.impactCount+1)&&this.shuttlecock.hasState("active")&&e&&e.x>=this.responsibleArea.min.x&&e.x<=this.responsibleArea.max.x&&e.z>=this.responsibleArea.min.z&&e.z<=this.responsibleArea.max.z&&(g=this.parent.localToTarget(this.targetPosition.clone().sub(e).setY(0),this,"direction"),g=g.angleTo(new THREE.Vector3(0,0,1))*(0>g.x?-1:1),h=b.angle,k=this.localToTarget(f.clone(),
this.parent,"direction"),k=e.clone().sub(k),e=this.predictFallingTime(f.y),f=Math.PI/d,l=0>e||e>f?0:e<f/2?THREE.Math.clamp(e*d,0,Math.PI):THREE.Math.clamp(Math.PI/2-(e-f/2)*d,0,Math.PI));c.angleB=0;c.updateMatrixWorld();this.impactElapsed+=a;this.checkIntersect(c.racket,this.shuttlecock.mesh)&&this.impactElapsed>this.impactDelta&&(e=c.racket.localToTarget(new THREE.Vector3(0,0,1),this.parent,"direction"),d*=this.getRacketImpactLength(),this.shuttlecock.impact(e.clone().multiplyScalar(d),e,this.racketAttenuation),
this.impactCount=this.shuttlecock.impactCount,this.healthPercent=THREE.Math.clamp(this.healthPercent-Math.min(this.healthPercentDecrease(d),this.healthPercentDecreaseMax()),0,100),this.impactElapsed=0,this.onAfterImpact());c.angleB=l;d=h-c.angleA;h=this.linkAngularSpeed*a*(0>d?-1:1);c.angleA+=Math.abs(d)<Math.abs(h)?d:h;c=k.clone().sub(this.position);d=c.clone().setLength(this.healthPercent/100*a*this.bodySpeed);c=c.length()<d.length()?c:d;this.position.add(c);0===c.length()&&(this.healthPercent=
THREE.Math.clamp(this.healthPercent+Math.min(this.healthPercentIncrease(a),this.healthPercentIncreaseMax()),0,100));g-=this.body.rotation.y;a=this.bodyAngularSpeed*a*(0>g?-1:1);this.body.rotation.y+=Math.abs(g)<Math.abs(a)?g:a},checkIntersect:function(a,b){a.updateMatrixWorld();b.updateMatrixWorld();null===a.geometry.boundingBox&&a.geometry.computeBoundingBox();var c=a.geometry.boundingBox,d=c.clone();d.min.z=d.max.z=0;var e=b.geometry.parameters.corkRadius,f=b.localToTarget(new THREE.Vector3(0,b.geometry.parameters.massCenter-
e,0),a),e=new THREE.Sphere(f,e);if(d.intersectsSphere(e))return!0;null===b.geometry.boundingSphere&&b.geometry.computeBoundingSphere();d=b.geometry.boundingSphere;e=b.localToTarget(d.center.clone(),this.parent);f=e.clone().addScaledVector(this.shuttlecock.velocity,-this.shuttlecock.lastDelta);this.parent.localToTarget(e,a);this.parent.localToTarget(f,a);var g=!1;0>=e.z*f.z&&(f=f.clone().sub(e),g=-e.z/f.z,e=e.clone().addScaledVector(f,g),g=this.checkIntersectRectAndCircle(c.clone().translate(e.clone().negate()),
d.radius));return g},checkIntersectRectAndCircle:function(a,b){return 0>a.max.x?0>a.max.y?a.max.x*a.max.x+a.max.y*a.max.y<b*b:0<a.min.y?a.max.x*a.max.x+a.min.y*a.min.y<b*b:Math.abs(a.max.x)<b:0<a.min.x?0>a.max.y?a.min.x*a.min.x+a.max.y*a.max.y<b*b:0<a.min.y?a.min.x*a.min.x+a.min.y*a.min.y<b*b:Math.abs(a.min.x)<b:0>a.max.y?Math.abs(a.max.y)<b:0<a.min.y?Math.abs(a.min.y)<b:!0},getTopImpactSpeed:function(a){var b=this.shuttlecock.position.clone().setY(0),c=this.targetPosition.clone().sub(b);a=c.clone().length();
b=Math.abs(b.clone().distanceTo(c));b=Math.ceil(b/100)-2;for(0>b&&(b=0);b<this.topForceTable.length&&!(this.topForceTable[b][0]>a);b++);if(0===b)return Math.PI*this.topForceTable[b][1];a=this.diff(this.topForceTable[b-1][0],this.topForceTable[b][0],a);return Math.PI*(this.topForceTable[b-1][1]+(this.topForceTable[b][1]-this.topForceTable[b-1][1])*a)},getImpactAngleAndSpeed:function(a){if(0<=this.targetPosition.x*this.shuttlecock.position.x)return[0,0];var b=this.targetPosition.clone().sub(this.shuttlecock.position).setY(0);
a=b.clone().multiplyScalar(this.shuttlecock.position.x/b.x).length();b=b.length()-a;a=this.angleAndSpeed(a,b);return[a[1],a[0]]},angleAndSpeed:function(a,b){var c=this.forceTable,d,e,f;for(d=0;d<c.length;d++){if(c[d][0]>=a&&0===d){for(e=1;e<c[d].length;e++)for(f=1;f<c[d][e].length;f++){if(c[d][e][f][0]>=b&&1===f)return[c[d][e][f][1],c[d][e][0]];if(c[d][e][f][0]>=b)return[this.calculate(c[d][e][f-1][0],c[d][e][f][0],c[d][e][f-1][1],c[d][e][f][1],b),c[d][e][0]]}return[c[d][e-1][c[d][e-1].length-1][1],
c[d][e-1][0]]}if(c[d][0]>=a){f=c[d-1].length;for(var g=c[d].length,h=1,l=1,k,m;c[d-1][h][0]>c[d][l][0];)h++;for(;h<f&&l<g;h++,l++){for(k=1;k<c[d-1][h].length;k++)if(c[d-1][h][k][0]>=b&&1===k){m=[c[d-1][h][k][1],c[d-1][h][0]];break}else if(c[d-1][h][k][0]>=b){m=[this.calculate(c[d-1][h][k-1][0],c[d-1][h][k][0],c[d-1][h][k-1][1],c[d-1][h][k][1],b),c[d-1][h][0]];break}for(k=1;k<c[d][l].length;k++)if(c[d][l][k][0]>=b&&1===k)if(void 0===m){e=[c[d][l][k][1],c[d][l][0]];break}else return[this.calculate(c[d-
1][0],c[d][0],m[0],c[d][l][k][1],b),m[1]];else if(c[d][l][k][0]>=b)if(e=this.calculate(c[d][l][k-1][0],c[d][l][k][0],c[d][l][k-1][1],c[d][l][k][1],b),void 0===m){e=[e,c[d][l][0]];break}else return[this.calculate(c[d-1][0],c[d][0],m[0],e,a),m[1]];void 0!==m&&(e=m,m=void 0)}f=c[d].length-1;g=c[d][f].length-1;return e?e:[c[d][f][g][1],c[d][f][0]]}}e=c[d-1].length-1;return[c[d-1][e][c[d-1][e].length-1][1],c[d-1][e][0]]},calculate:function(a,b,c,d,e){a=this.diff(a,b,e);return c*(1-a)+d*a},diff:function(a,
b,c){return(c-a)/(b-a)},forceTable:[[50,[1.43,[43.42,20],[70.19,30],[91.41,40],[107.47,50]],[1.4,[55.65,20],[88.51,30],[113.96,40],[133.25,50],[148.81,60],[161.05,70]]],[100,[1.4,[38.51,30],[63.96,40],[83.25,50],[98.81,60]],[1.3,[45.31,20],[95.07,30],[133.89,40],[163.39,50],[185.91,60]],[1.2,[79.3,20],[144.44,30],[194.13,40],[233.14,50],[262.99,60]],[1.1,[108.26,20],[185.34,30],[245.82,40],[292.09,50],[328.79,60]],[1,[216.99,30],[287.38,40],[341.44,50],[384.46,60],[419.77,70],[450.58,80],[476.44,
90],[498.25,100]],[.9,[318.21,40],[379.59,50],[428.26,60],[468.87,70],[502.53,80],[532.33,90],[557.45,100],[580.05,110]]],[200,[1.2,[44.44,30],[94.13,40],[133.14,50],[163.81,60],[189.01,70],[209.24,80]],[1.1,[85.34,30],[145.82,40],[192.09,50],[229.86,60],[261,70],[286.02,80],[307.82,90],[327.16,100]],[1,[116.99,30],[187.38,40],[241.44,50],[284.19,60],[321.01,70],[350.58,80],[376.44,90],[398.25,100]],[.9,[143.63,30],[218.22,40],[279.59,50],[328.26,60],[368.62,70],[402.53,80],[432.33,90],[457.45,100]],
[.8,[158.26,30],[240.35,40],[306.23,50],[360.5,60],[405.4,70],[443.36,80],[474.98,90],[503.3,100]],[.7,[251.39,40],[322.86,50],[379.58,60],[429.38,70],[471.02,80],[505.89,90],[537.25,100],[563.52,110],[589.46,120],[611.24,130]],[.6,[256.65,40],[333.25,50],[390.98,60],[444.93,70],[487.23,80],[525.14,90],[559.35,100],[587.9,110],[613.94,120],[637.81,130],[659.78,140],[677.87,150]],[.5,[389.42,60],[443.85,70],[489.17,80],[530,90],[563.83,100],[594.63,110],[622.84,120],[648.79,130],[669.9,140],[692.18,
150],[710.19,160],[726.92,170]]],[300,[1.1,[45.82,40],[92.09,50],[129.86,60],[161,70],[186.02,80],[207.82,90],[227.16,100]],[1,[85.77,40],[141.44,50],[184.18,60],[221,70],[250.58,80],[276.44,90],[298.25,100],[317.83,110]],[.9,[118.21,40],[179.58,50],[228.25,60],[268.62,70],[302.53,80],[332.33,90],[357.45,100],[380.05,110]],[.8,[140.35,40],[208.4,50],[260.23,60],[305.4,70],[343.36,80],[374.98,90],[403.3,100],[428.87,110],[450.42,120],[471.66,130],[488.09,140],[504.67,150]],[.7,[154.2,40],[225.48,50],
[282.08,60],[331.71,70],[373.22,80],[407.99,90],[439.25,100],[465.46,100],[463.52,110],[489.46,120],[511.24,130],[529.36,140],[547.87,150],[564.98,160],[579.14,170],[592.27,180],[604.48,190],[615.85,200]],[.6,[156.64,40],[233.25,50],[290.98,60],[344.93,70],[387.23,80],[425.14,90],[459.35,100],[487.9,110],[513.94,120],[537.81,130],[559.78,140],[577.87,150],[594.58,160],[612.19,170],[626.54,180],[639.9,190],[652.37,200],[662.04,210]],[.5,[228.18,50],[289.42,60],[343.85,70],[389.17,80],[430,90],[463.83,
100],[494.64,110],[522.84,120],[548.79,130],[569.89,140],[592.18,150],[610.19,160],[626.92,170],[642.5,180],[657.04,190],[670.62,200],[683.34,210],[692.82,220]]],[400,[1,[84.19,60],[121,70],[151.71,80],[176.44,90]],[.9,[79.59,50],[128.26,60],[168.62,70],[203.97,80],[232.33,90],[257.45,100]],[.8,[108.4,50],[160.23,60],[205.4,70],[243.14,80],[274.98,90],[303.3,100],[328.87,110],[350.42,120]],[.7,[125.49,50],[182.09,60],[231.71,70],[273.22,80],[305.89,90],[337.25,100],[363.52,110],[389.46,120],[411.24,
130],[429.36,140]],[.6,[133.25,50],[190.98,60],[244.93,70],[287.23,80],[325.14,90],[359.35,100],[387.89,110],[413.94,120],[437.81,130],[459.78,140],[477.87,150],[494.58,160],[512.19,170],[526.54,180]],[.5,[189.42,60],[243.85,70],[289.16,80],[329.99,90],[363.83,100],[394.64,110],[422.84,120],[448.79,130],[469.9,140],[492.18,150],[510.19,160],[526.92,170],[542.5,180],[557.04,190],[570.62,200],[583.34,210],[592.82,220],[604.05,230],[612.2,240],[622.16,250],[631.52,260],[638.02,270],[644.03,280],[651.9,
290]],[.4,[230.95,70],[279.01,80],[318.59,90],[354.57,100],[387.5,110],[417.77,120],[442.11,130],[468.12,140],[488.87,150],[508.13,160],[526.08,170],[542.83,180],[558.51,190],[570,200],[583.84,210],[296.85,220],[606,230],[617.58,240],[625.47,250],[635.8,260],[642.59,270],[648.87,280],[657.65,290],[663.02,300],[667.96,310],[675.42,320],[679.59,330],[683.39,340]]],[500,[.9,[68.87,70],[102.53,80],[132.33,90],[157.45,100],[180.05,110],[200.51,120],[217.87,130],[233.74,140],[248.31,150],[260.61,160]],
[.8,[105.64,70],[143.36,80],[174.98,90],[203.3,100],[228.87,110],[250.42,120],[271.66,130],[288.09,140],[304.67,150],[319.96,160],[332.74,170],[345.92,180],[356.88,190],[367.07,200],[376.57,210],[385.42,220]],[.7,[79.58,60],[129.38,70],[171.02,80],[205.89,90],[237.25,100],[263.52,110],[289.46,120],[311.24,130],[329.36,140],[347.87,150],[364.98,160],[379.14,170],[392.27,180],[404.48,190],[415.85,200],[426.45,210],[436.36,220],[445.62,230],[454.28,240],[460.91,250],[468.53,260],[474.23,270],[480.94,
280],[485.81,290],[491.71,300],[495.85,310]],[.6,[142.1,70],[187.23,80],[225.14,90],[259.35,100],[287.9,110],[313.94,120],[337.81,130],[359.78,140],[377.87,150],[394.58,160],[412.19,170],[426.54,180],[439.9,190],[452.37,200],[462.05,210],[472.97,220],[483.21,230],[492.79,240],[499.94,250],[508.4,260],[514.54,270],[522.03,280],[527.28,290],[533.89,300],[538.36,310],[542.46,320],[547.94,330],[551.37,340]],[.5,[140.39,70],[189.17,80],[230,90],[263.83,100],[294.64,110],[322.84,120],[348.79,130],[369.9,
140],[392.18,150],[410.19,160],[426.92,170],[442.5,180],[457.04,190],[470.62,200],[483.34,210],[492.82,220],[540.05,230],[512.2,240],[522.16,250],[531.51,260],[538.02,270],[544.03,280],[551.9,290],[557.04,300],[564.03,310],[568.38,320],[572.36,330],[576,340]],[.4,[179.01,80],[218.59,90],[254.57,100],[287.5,110],[317.77,120],[342.11,130],[368.12,140],[388.87,150],[408.13,160],[426.08,170],[442.83,180],[458.51,190],[470,200],[483.84,210],[496.85,220],[506,230],[517.58,240],[525.47,250],[535.8,260],
[542.59,270],[548.87,280],[557.65,290],[563.02,300],[567.96,310],[575.42,320],[579.59,330],[583.39,340],[586.84,350]]],[600,[.9,[57.45,100],[80.05,110],[100.51,120],[117.87,130]],[.8,[70.98,90],[103.3,100],[128.87,110],[150.42,120],[171.66,130],[188.09,140]],[.7,[73.22,80],[105.89,90],[137.25,100],[163.52,110],[189.46,120],[211.24,130],[229.36,140],[247.87,150],[264.98,160],[279.14,170],[292.27,180],[304.48,190]],[.6,[87.23,80],[125.14,90],[159.35,100],[187.9,110],[213.94,120],[237.81,130],[259.78,
140],[277.87,150],[294.58,160],[312.19,170],[326.54,180],[339.9,190],[352.37,200],[362.05,210],[372.97,220],[383.21,230]],[.5,[126.79,90],[163.83,100],[194.64,110],[222.84,120],[248.79,130],[262.9,140],[292.18,150],[310.19,160],[326.92,170],[342.5,180],[357.04,190],[370.62,200],[383.34,210],[392.82,220],[404.05,230],[412.2,240],[422.16,250],[431.52,260],[438.02,270],[444.03,280],[451.9,290],[457.04,300],[464.03,310],[468.38,320]],[.4,[154.57,100],[187.5,110],[217.77,120],[242.12,130],[268.12,140],
[288.87,150],[308.13,160],[326.08,170],[342.83,180],[358.51,190],[370,200],[383.84,210],[396.85,220],[406,230],[417.58,240],[425.47,250],[435.8,260],[442.59,270],[448.87,280],[457.65,290],[463.02,300],[467.96,310],[475.42,320],[479.59,330],[483.39,340],[486.84,350]]],[670,[.9,[30.51,120],[47.87,130],[63.74,140],[78.32,150],[90.61,160],[103.06,170]],[.8,[58.87,110],[80.42,120],[101.66,130],[118.09,140],[134.67,150],[149.96,160],[162.74,170],[175.92,180],[186.88,190],[197.07,200],[206.57,210],[215.42,
220]],[.7,[67.25,100],[93.52,110],[119.46,120],[141.24,130],[159.36,140],[177.87,150],[194.98,160],[209.14,170],[222.27,180],[234.48,190],[245.85,200],[256.45,210]],[.6,[86.85,100],[117.9,110],[143.94,120],[167.81,130],[189.78,140],[207.87,150],[224.58,160],[242.19,170],[256.54,180],[269.9,190],[282.37,200],[292.05,210],[302.97,220],[313.21,230],[322.79,240],[329.94,250],[338.4,260],[344.54,270],[352.03,280],[357.28,290]],[.5,[124.76,110],[152.84,120],[178.79,130],[199.9,140],[222.18,150],[240.19,
160],[256.92,170],[272.5,180],[284.04,190],[300.62,200],[313.34,210],[322.82,220],[334.05,230],[342.2,240],[352.16,250],[361.52,260],[368.02,270],[374.03,280],[381.9,290],[387.04,300],[394.03,310],[398.38,320],[402.36,330],[406,340],[411.5,350],[414.48,360]],[.4,[147.77,120],[172.11,130],[198.12,140],[218.87,150],[238.13,160],[256.08,170],[272.83,180],[288.51,190],[300,200],[313.84,210],[326.85,220],[336,230],[347.58,240],[355.47,250],[365.8,260],[372.59,270],[378.87,280],[387.65,290],[393.02,300],
[397.96,310],[405.42,320],[409.59,330],[413.39,340],[416.84,350],[422.81,360],[425.6,370]]]],topForceTable:[[432.837,12],[508.317,15],[612.811,20],[697.075,25],[767.586,30],[793.203,32],[829.48,35],[849.617,37],[860.173,38],[880.123,40],[925.701,45],[966.793,50],[1002.28,55],[1036.857,60],[1064.451,65],[1091.885,70],[1118.193,75],[1140.245,80],[1160.976,85],[1182.143,90],[1200.124,95],[1217.301,100],[1233.056,105],[1248.758,110],[1261.102,115],[1274.775,120],[1287.784,125],[1298.189,130],[1309.88,
135],[1321.354,140],[1329.665,145],[1333.054,150]],topTableStart:[0,1,2,3,5,6],onAfterImpact:function(){},onBeforeUpdate:function(){}});N.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:N,inArea:function(a,b){return this.getArea(a).containsPoint(b)},getArea:function(a){return this["getArea"+a]()},getAreaAll:function(){return new THREE.Box3(new THREE.Vector3(-this.geometry.parameters.longLineSingle,-this.geometry.parameters.sidelineDouble,0),new THREE.Vector3(this.geometry.parameters.longLineSingle,
this.geometry.parameters.sidelineDouble,0))},getAreaSingle:function(){return new THREE.Box3(new THREE.Vector3(-this.geometry.parameters.longLineSingle,-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(this.geometry.parameters.longLineSingle,this.geometry.parameters.sidelineSingle,0))},getAreaSingleA:function(){return new THREE.Box3(new THREE.Vector3(-this.geometry.parameters.longLineSingle,-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(0,this.geometry.parameters.sidelineSingle,
0))},getAreaSingleFirstA:function(){return new THREE.Box3(new THREE.Vector3(-this.geometry.parameters.longLineSingle,-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(-this.geometry.parameters.shortLine,this.geometry.parameters.sidelineSingle,0))},getAreaSingleFirstLeftA:function(){return new THREE.Box3(new THREE.Vector3(-this.geometry.parameters.longLineSingle,0,0),new THREE.Vector3(-this.geometry.parameters.shortLine,this.geometry.parameters.sidelineSingle,0))},getAreaSingleFirstRightA:function(){return new THREE.Box3(new THREE.Vector3(-this.geometry.parameters.longLineSingle,
-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(-this.geometry.parameters.shortLine,0,0))},getAreaSingleB:function(){return new THREE.Box3(new THREE.Vector3(0,-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(this.geometry.parameters.longLineSingle,this.geometry.parameters.sidelineSingle,0))},getAreaSingleFirstB:function(){return new THREE.Box3(new THREE.Vector3(this.geometry.parameters.shortLine,-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(this.geometry.parameters.longLineSingle,
this.geometry.parameters.sidelineSingle,0))},getAreaSingleFirstLeftB:function(){return new THREE.Box3(new THREE.Vector3(this.geometry.parameters.shortLine,-this.geometry.parameters.sidelineSingle,0),new THREE.Vector3(this.geometry.parameters.longLineSingle,0,0))},getAreaSingleFirstRightB:function(){return new THREE.Box3(new THREE.Vector3(this.geometry.parameters.shortLine,0,0),new THREE.Vector3(this.geometry.parameters.longLineSingle,this.geometry.parameters.sidelineSingle,0))}});y.prototype=Object.defineProperties(Object.assign(Object.create(THREE.Mesh.prototype),
{constructor:y}),{number:{get:function(){return this.material.getNumber()},set:function(a){this.material.setNumber(a)}}});O.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:O,init:function(){for(var a=0;a<this.frontCards.length;a++)this.frontCards[a].number=0,this.transitionCards[a].number=this.backCards[a].number=1,this.transitionCards[a].visible=!1},addCard:function(a,b,c,d){var e={},f;for(f in d)e[f]=d[f];e.number=e.number||0;var g=new THREE.Object3D;g.position.set(c.x,
1.01*this.geometry.parameters.height,0);g.rotation.set(2*Math.PI-this.geometry.parameters.planeAngle,0,0);this.add(g);var h=g.clone();h.rotation.x=this.geometry.parameters.planeAngle;this.add(h);d=h.clone();this.add(d);f=new y(new THREE.PlaneGeometry(a,b),new w(e));f.position.set(0,-c.y-b/2,0);g.add(f);this.frontCards.push(f);e.number++;c=new y(new THREE.PlaneGeometry(a,b),new w(e));c.position.copy(f.position);h.add(c);this.backCards.push(c);a=new y(new THREE.PlaneGeometry(a,b),new w(e));a.position.copy(f.position);
d.add(a);this.transitionCards.push(a);a.visible=!1;this.actions.push(null)},addRings:function(a,b){for(var c=0;c<b.length;c++){var d=b[c],e=a.clone();e.position.set(d,this.geometry.parameters.height,0);this.add(e)}},setAction:function(a,b,c){var d=this.frontCards[a],e=this.backCards[a],f=this.transitionCards[a];"next"===c?(e.number=b+1,f.number=b,f.parent.rotation.x=e.parent.rotation.x):(f.number=d.number,f.parent.rotation.x=d.parent.rotation.x,d.number=b);f.visible=!0;this.actions[a]={index:a,number:b,
direction:c}},update:function(a){for(var b=0;b<this.actions.length;b++)null!==this.actions[b]&&this.updateCard(a,this.actions[b])},updateCard:function(a,b){var c=this.frontCards[b.index],d=this.backCards[b.index],e=this.transitionCards[b.index],f="next"===b.direction?c:d,g=f.parent.rotation.x-e.parent.rotation.x,h=this.speed*a*(0>g?-1:1);e.parent.rotation.x+=Math.abs(g)<Math.abs(h)?g:h;e.parent.rotation.x===f.parent.rotation.x&&("next"===b.direction?c.number=b.number:d.number=e.number,e.visible=!1,
this.actions[b.index]=null)}});P.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:P,checkCollision:function(a){var b=new THREE.Vector3(0,a.geometry.parameters.massToCorkCenterLength,0),c=new THREE.Sphere(b,a.geometry.parameters.corkRadius),d=a.localToTarget(b.clone(),a.parent),e=d.clone().addScaledVector(a.velocity,-a.lastDelta);a.parent.localToTarget(d,this.net);a.parent.localToTarget(e,this.net);if(0>d.z*e.z){var e=e.clone().sub(d),f=-d.z/e.z;b.copy(d.clone().addScaledVector(e,
f));d=(new THREE.Box3).setFromCenterAndSize(this.parameters.netCenter,this.parameters.netSize);d.intersectsSphere(c)?(a.replaceState("active","hung"),a.position.copy(this.net.localToTarget(b.clone(),a.parent)),a.flipFrame.rotation.set(0,0,0)):b.y+c.radius<d.min.y&&a.addState("under-net")}}});Q.prototype={constructor:Q,init:function(a){this.scoreB=this.scoreA=this.nthScore=0;this.lastWinner=void 0!==a?a:"A"},nextScore:function(a){this.nthScore=a||this.nthScore+1},getScore:function(a){return this["score"+
a]},setScore:function(a,b){this["score"+a]=b},getAnotherPlayer:function(a){return"A"===a?"B":"A"},getToppledValidAreaName:function(a,b){return 1>=b?"SingleFirst"+(0===this.getScore(a)%2?"Right":"Left")+this.getAnotherPlayer(a):"Single"+(0===b%2?a:this.getAnotherPlayer(a))},initRobot:function(a,b,c){var d=0===this.getScore(this.lastWinner)%2;b=b.localToTarget(b.getArea("SingleFirst"+(d?"Right":"Left")+c),a.parent);a.init();a.setResponsibleArea(b,!0)},initShuttlecock:function(a,b){a.init();var c=b(),
d;for(d in c){var e=c[d];"function"===typeof e.copy?a[d].copy(e):a[d]=e}a.updateActive(0)},checkScore:function(a,b){if(this.nthScore>this.scoreA+this.scoreB){var c=a.hasState("hung"),d=a.hasState("toppled");if(c||d){var e=a.hasState("under-net"),f=1===a.impactCount%2;c||d&&e?f=!f:(c=this.getToppledValidAreaName(this.lastWinner,a.impactCount),c=b.getArea(c),d=new THREE.Vector3(0,a.geometry.parameters.massToCorkCenterLength,0),e=new THREE.Sphere(d,a.geometry.parameters.corkRadius),a.localToTarget(d,
b).projectOnPlane(new THREE.Vector3(0,0,1)),f=(c=c.intersectsSphere(e))&&f||!c&&!f);f=f?this.lastWinner:this.getAnotherPlayer(this.lastWinner);c=this.getScore(f);this.setScore(f,c+1);this.lastWinner=f;this.onScoreChange()}}},onScoreChange:function(){}};R.prototype={constructor:R,init:function(a){this.counter=0;this.playing=!1;this.data=a||[];a||this.record()},start:function(a){0>a&&(a=this.data.length-1+a);this.counter=THREE.Math.clamp(a||0,0,this.data.length-1);this.counter<this.data.length&&(this.setData(this.robot1,
this.data[this.counter].robot1.init),this.setData(this.robot2,this.data[this.counter].robot2.init),this.setData(this.shuttlecock,this.data[this.counter].shuttlecock.init),this.next())},next:function(){++this.counter<this.data.length&&(this.setData(this.robot1,this.data[this.counter].robot1.play),this.setData(this.robot2,this.data[this.counter].robot2.play));this.playing=this.counter+1<this.data.length},record:function(){this.data.push({robot1:{init:this.getData(this.robot1,this.KEYS_ROBOT_INIT),play:this.getData(this.robot1,
this.KEYS_ROBOT_PLAY)},robot2:{init:this.getData(this.robot2,this.KEYS_ROBOT_INIT),play:this.getData(this.robot2,this.KEYS_ROBOT_PLAY)},shuttlecock:{init:this.getData(this.shuttlecock,this.KEYS_SHUTTLECOCK_INIT)}})},getValue:function(a){switch(typeof a){case "object":if("function"===typeof a.toArray)return a.toArray();default:return a}},getData:function(a,b){for(var c={},d=0;d<b.length;d++){var e=a,f=b[d];f.split(".").forEach(function(a){e=e[a]});c[f]=this.getValue(e)}return c},setData:function(a,
b){for(var c in b){var d=a,e=b[c];c.split(".").forEach(function(a,b,c){b<c.length-1?d=d[a]:"function"===typeof d[a].fromArray?d[a].fromArray(e):d[a]=e})}},KEYS_ROBOT_INIT:"position rotation impactCount impactElapsed body.rotation.y responsibleArea".split(" "),KEYS_ROBOT_PLAY:["impactType","healthPercent","targetPosition"],KEYS_SHUTTLECOCK_INIT:["state","position","rotation","velocity","impactCount"]};K.prototype={constructor:K,get volume(){return this._volume},set volume(a){this._volume=a;this.updateVolume()},
get leftVolume(){return this._leftVolume},set leftVolume(a){this._leftVolume=a;this.updateVolume()},get rightVolume(){return this._rightVolume},set rightVolume(a){this._rightVolume=a;this.updateVolume()},updateVolume:function(){this.leftGain.gain.value=this.leftVolume*this.volume;this.rightGain.gain.value=this.rightVolume*this.volume},setEqualizer:function(a){this._leftVolume=.5>a?1:(1-a)/.5;this._rightVolume=.5<a?1:(a-0)/.5;this.updateVolume()}};K.support=function(){return window.AudioContext||window.webkitAudioContext||
window.mozAudioContext||window.msAudioContext||!1};S.prototype={constructor:S,getRanks:function(){var a=this.localStorage.getItem(this.namespace);if(a){for(var a=a.split(this.separaor),b=0;b<a.length;b++)a[b]=Number(a[b]);return a}return[]},addRank:function(a){var b=this.getRanks();b.push(a);b.sort(function(a,b){return b-a});b.length>this.maxCount&&(b.length=this.maxCount);this.localStorage.setItem(this.namespace,b.join(this.separaor))},getBestRank:function(){return this.getRanks()[0]||0}};m.ShuttlecockGeometry=
t;m.HyperbolaGeometry=A;m.NetGeometry=E;m.CourtGeometry=F;m.RacketGeometry=G;m.ScoreboardGeometry=H;m.ArrowGeometry=I;m.PixelMaterial=J;m.NumberMaterial=w;m.Shuttlecock=L;m.Robot=M;m.Court=N;m.Scoreboard=O;m.ScoreboardCard=y;m.NetGroup=P;m.Game=Q;m.Record=R;m.AudioChannel=K;m.Ranking=S;Object.defineProperty(m,"__esModule",{value:!0})});
