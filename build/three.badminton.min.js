(function(t,y){"object"===typeof exports&&"undefined"!==typeof module?y(exports):"function"===typeof define&&define.amd?define(["exports"],y):y((t.THREE=t.THREE||{},t.THREE.Badminton=t.THREE.Badminton||{}))})(this,function(t){function y(a,b,c,d,f,e,h,g,n,l,p,k){THREE.Geometry.call(this);this.type="ShuttlecockGeometry";var q=(5*a*a+12*c*a+6*c*c)/(4*(2*a+3*c)),u=d/4*(a*a+2*b*a+3*b*b)/(a*a+b*a+b*b),t=void 0===k?a+c:(q*k+u)/(k+1),B=Math.atan((b-a)/(c+d)),m=a+u/d*(b-a);this.parameters={corkRadius:a,skirtRadius:b,
beltHeight:c,skirtHeight:d,widthSegments:f,heightSegments:e,rachisRadius:h,rachisRatio:g,featherWidth:n,featherRatio:l,featherAngle:p,massRatio:k,massCenter:t,corkMassCenter:q,skirtMassCenter:u,corkAngle:B,massToCorkTopLength:a/Math.tan(B),massToCorkCenterLength:t-q,skirtCrossSectionalArea:Math.PI*m*m};k=-a+t;q=new THREE.SphereGeometry(a,f,e,0,2*Math.PI,0,Math.PI/2);this.merge(q,(new THREE.Matrix4).compose(new THREE.Vector3(0,k,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,Math.PI/2,0,
"XYZ")),new THREE.Vector3(1,1,1)),0);k-=c/2;q=new THREE.CylinderGeometry(a,a,c,f,1,!0,0,2*Math.PI);this.merge(q,(new THREE.Matrix4).compose(new THREE.Vector3(0,k,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(0,0,0,"XYZ")),new THREE.Vector3(1,1,1)),1);k-=c/2;c=new THREE.CircleGeometry(a,f,0,2*Math.PI);this.merge(c,(new THREE.Matrix4).compose(new THREE.Vector3(0,k,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,0,0,"XYZ")),new THREE.Vector3(1,1,1)),2);q=a-h;a=k-d*g/(1+g);c=
q+(b-q)*g/(1+g);u=new THREE.TorusGeometry(c,h,2*e,f,2*Math.PI);this.merge(u,(new THREE.Matrix4).compose(new THREE.Vector3(0,a,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,0,0,"XYZ")),new THREE.Vector3(1,1,1)),3);u=(k+a)/2;e=new THREE.TorusGeometry((q+c)/2,h,2*e,f,2*Math.PI);this.merge(e,(new THREE.Matrix4).compose(new THREE.Vector3(0,u,0),(new THREE.Quaternion).setFromEuler(new THREE.Euler(Math.PI/2,0,0,"XYZ")),new THREE.Vector3(1,1,1)),3);e=(q+b)/2;b=-Math.atan((b-q)/d);q=d/Math.cos(b);
d=k-d/2;h=new THREE.CylinderGeometry(h,h,q,f,1,!1,0,2*Math.PI);for(k=0;k<h.faces.length;k++)h.faces[k].materialIndex=0;k=1/(1+g)*q;g=new THREE.Geometry;g.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(n,l/(1+l)*-k,0),new THREE.Vector3(-n,l/(1+l)*-k,0),new THREE.Vector3(0,-k,0));g.faces.push(new THREE.Face3(0,2,3),new THREE.Face3(0,3,1));g.faceVertexUvs[0].push([new THREE.Vector2(0,1),new THREE.Vector2(0,0),new THREE.Vector2(1,0)],[new THREE.Vector2(1,1),new THREE.Vector2(0,0),new THREE.Vector2(1,
0)]);g.computeFaceNormals();g.computeVertexNormals();for(k=0;k<f;k++)l=2*Math.PI/f*k,q=Math.sin(l)*e,u=Math.cos(l)*e,n=new THREE.Euler(b,l,0,"YXZ"),this.merge(h,(new THREE.Matrix4).compose(new THREE.Vector3(q,d,u),(new THREE.Quaternion).setFromEuler(n),new THREE.Vector3(1,1,1)),3),q=Math.sin(l)*c,l=Math.cos(l)*c,n=(new THREE.Matrix4).makeRotationFromEuler(n).multiply((new THREE.Matrix4).makeRotationY(p)),this.merge(g,(new THREE.Matrix4).compose(new THREE.Vector3(q,a,l),(new THREE.Quaternion).setFromRotationMatrix(n),
new THREE.Vector3(1,1,1)),4)}function F(a,b,c,d,f,e,h,g){THREE.Object3D.call(this);a instanceof y&&(f=a.parameters.corkAngle,e=a.parameters.massToCorkTopLength,h=a.parameters.massToCorkCenterLength,g=a.parameters.skirtCrossSectionalArea);this.geometry=a;this.material=b;this.parameters={mass:c+d,corkMass:c,skirtMass:d,corkAngle:f,massToCorkTopLength:e,massToCorkCenterLength:h,skirtCrossSectionalArea:g};c=new THREE.Object3D;this.add(c);a=new THREE.Mesh(a,b);c.add(a);this.flipFrame=c;this.mesh=a;this.dragCoefficient=
.44;this.groundAttenuation=.9;this.meter2unit=1;this._airDensity=1.1839;this._gravity=new THREE.Vector3(0,-9.8,0);this.velocity=new THREE.Vector3(0,0,0);this.flipAngularVelocity=this.flipAngle=0;this.flipAxis=new THREE.Vector3(0,0,0);this.stopAngularVelocity=3*Math.PI;this.state="move";this.impactCount=this.lastDelta=0}function I(a,b,c,d,f,e){THREE.Object3D.call(this);a=void 0!==a?a:50;b=void 0!==b?b:160;c=void 0!==c?c:50;d=void 0!==d?d:50;f=void 0!==f?f:30;e=void 0!==e?e:1;this.parameters={bodyWidth:a,
bodyHeight:b,bodyDepth:c,racketLength:d,racketWidth:f,racketDepth:e};var h=new THREE.Mesh(new THREE.BoxGeometry(a,b,c),new THREE.MeshNormalMaterial({wireframe:!0}));h.position.set(0,b/2,0);this.add(h);for(var g=2*b/3,n=g/3,l=2*Math.PI/12,p=a/2.5,k=g/2,q=new THREE.Vector3(0,k,0),u=new THREE.Geometry,t=new THREE.Object3D,B=0;B<=g;B+=n)for(var m=B,w=Math.sqrt(((m-q.y)*(m-q.y)/(k*k)+1)*p*p)-q.x,r=0;r<2*Math.PI;r+=l)t.rotation.y=r,t.updateMatrixWorld(),u.vertices.push(t.localToWorld(new THREE.Vector3(w,
m,0)));r=Math.floor(u.vertices.length-12);for(g=0;g<r;g++)n=11===g%12?new THREE.Face3(g,g+1-12,g+12):new THREE.Face3(g,g+1,g+12),n.materialIndex=0,u.faces.push(n),m=Math.floor(g/12)/3,w=g%12/12,l=new THREE.Vector2(w+1/12,m),p=new THREE.Vector2(w,m+1/3),k=new THREE.Vector2(w+1/12,m+1/3),u.faceVertexUvs[0].push([new THREE.Vector2(w,m),l,p]),m=11===g%12?new THREE.Face3(g+12,g-11,g+1):new THREE.Face3(g+12,g+1,g+12+1),n.materialIndex=0,u.faces.push(m),u.faceVertexUvs[0].push([p,l,k]);u.computeBoundingSphere();
u.computeFaceNormals();u.computeVertexNormals();m=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide});u=new THREE.Mesh(u,m);u.position.set(0,-b/2,0);h.add(u);m=new THREE.SphereGeometry(1*b/6,32,32);m=new THREE.Mesh(m,new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide}));m.position.set(0,1*b/3,0);h.add(m);g=Object.defineProperties(new THREE.Object3D,{angleA:{get:function(){return-this.rotation.x},set:function(a){this.rotation.x=-a}},angleB:{get:function(){return this.rotation.y},set:function(a){this.rotation.y=
a}}});n=new THREE.Mesh(new THREE.BoxGeometry(d,f,e),new THREE.MeshNormalMaterial({wireframe:!0}));n.position.set(d/2,0,0);g.add(n);g.position.set(a/2,0,0);h.add(g);l=Object.defineProperties(new THREE.Object3D,{angleA:{get:function(){return-this.rotation.x},set:function(a){this.rotation.x=-a}},angleB:{get:function(){return-this.rotation.y},set:function(a){this.rotation.y=-a}}});p=new THREE.Mesh(new THREE.BoxGeometry(d,f,e),new THREE.MeshNormalMaterial({wireframe:!0}));p.position.set(-d/2,0,0);l.add(p);
l.position.set(-a/2,0,0);h.add(l);k=Object.defineProperties(new THREE.Object3D,{angleA:{get:function(){return this.rotation.x},set:function(a){this.rotation.x=a}},angleB:{get:function(){return-this.frame.rotation.x},set:function(a){this.frame.rotation.x=-a}}});m=new THREE.Object3D;f=new THREE.Mesh(new THREE.BoxGeometry(f,d,e),new THREE.MeshNormalMaterial({wireframe:!0}));f.position.set(0,d/2,0);m.add(f);k.position.set(0,b/2,0);k.frame=m;k.add(m);h.add(k);e=.3*a<b/3?.3*a:b/3;for(var r=new THREE.Vector2(.3*
a-a/2,5*b/6-b/2),w=new THREE.Vector2(.7*a-a/2,5*b/6-b/2),m=e/23,q=new THREE.Object3D,t=new THREE.Object3D,B=new THREE.Object3D,C=new THREE.Object3D,y=new THREE.Vector3(r.x-e/2+m/2,r.y+e/2-m/2,c/2),E=new THREE.Vector3(r.x+e/2-m/2,r.y-e/2+m/2,c/2),D=new THREE.Vector3(w.x-e/2+m/2,w.y+e/2-m/2,c/2),F=new THREE.Vector3(w.x+e/2-m/2,w.y-e/2+m/2,c/2),z=e/23+2*e/23/19,G=new THREE.PlaneGeometry(m,m),H=new THREE.MeshBasicMaterial({side:THREE.DoubleSide}),r=0;2>r;r++)for(var w=0===r?y.x:D.x,m=0===r?y.y:D.y,x=
Math.floor(4);x<Math.ceil(6);x++)for(var v=0;20>v;v++){var A=new THREE.Mesh(G,H);A.position.set(v*z+w,m-x*z,.1+c/2);q.add(A)}for(r=0;2>r;r++)for(w=0===r?y.x:D.x,m=0===r?y.y:D.y,x=Math.floor(6);x<Math.ceil(18);x++)for(v=Math.floor(7);v<Math.ceil(13);v++)A=new THREE.Mesh(G,H),A.position.set(v*z+w,m-x*z,.1+c/2),0===r?B.add(A):t.add(A);q.add(B);q.add(t);h.add(q);for(r=w=0;r<Math.ceil(10);r++)for(x=0;2>x&&20>w;x++,w++)A=new THREE.Mesh(G,H),A.position.set(y.clone().x+w*z,y.clone().y-r*z,.1+c/2),C.add(A),
v=A.clone(),v.position.y-=z,C.add(v),m=A.clone(),m.position.set(D.clone().x+(20-w)*z,D.clone().y-r*z,.1+c/2),C.add(m),v=m.clone(),v.position.y-=z,C.add(v);for(;20>r;r++)for(x=Math.floor(14),A=new THREE.Mesh(G,H),A.position.set(y.clone().x+x*z,y.clone().y-r*z,.1+c/2),m=new THREE.Mesh(G,H),m.position.set(D.clone().x+(20-x)*z,D.clone().y-r*z,.1+c/2),C.add(A),C.add(m),x++,w=20-x,x=1;x<w;x++)v=A.clone(),v.position.x+=z*x,C.add(v),v=m.clone(),v.position.x-=z*x,C.add(v);this.body=h;this.waist=u;this.leftLink=
g;this.leftRacket=n;this.leftImpactWidth=a/2+d/2;this.leftImpactHeight=b/2;this.rightLink=l;this.rightRacket=p;this.rightImpactWidth=a/2+d/2;this.rightImpactHeight=b/2;this.topLink=k;this.topRacket=f;this.topImpactWidth=0;this.topImpactAngle=-Math.PI/15;this.impactClock=new THREE.Clock;this.impactClock.start();this.impactDelta=1;this.impactCount=0;this.court=null;this.limits={xMin:0,xMax:0,zMin:0,zMax:0};this.limitEpsilon=.1;this.shuttle=null;this.racketAttenuation=.9;this.bodySpeed=1E3;this.bodyAngularSpeed=
2*Math.PI;this.linkAngularSpeed=2*Math.PI;this._netHeight=1.55;this._netHeightDelta=.2;this.targetPosition=new THREE.Vector3(0,0,0);this.impactType="right";this.smashSpeed=100*Math.PI;this.healthPercent=100;this.healthAttenuation=.99;this.side=e;this.addUnit=z;this.rightEyePixelRange={first:y,last:E};this.leftEyePixelRange={first:D,last:F};this.eyes=q;this.leftEyeBall=t;this.rightEyeBall=B;this.smashEyes=C;this.eyeStatus="common";this.impactAudio=this.camera=null}function J(a){a=void 0!==a?a:1;this.parameters=
{meter2unit:a};var b=new THREE.LineBasicMaterial,c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(-6.7,0,-3.05),new THREE.Vector3(-6.7,0,3.05),new THREE.Vector3(-5.94,0,-3.05),new THREE.Vector3(-5.94,0,3.05),new THREE.Vector3(-1.98,0,-3.05),new THREE.Vector3(-1.98,0,3.05),new THREE.Vector3(0,0,-3.05),new THREE.Vector3(0,0,3.05),new THREE.Vector3(0,1.55,-3.05),new THREE.Vector3(0,1.55,3.05),new THREE.Vector3(0,0,-3.05),new THREE.Vector3(0,0,3.05),new THREE.Vector3(1.98,0,-3.05),new THREE.Vector3(1.98,
0,3.05),new THREE.Vector3(5.94,0,-3.05),new THREE.Vector3(5.94,0,3.05),new THREE.Vector3(6.7,0,-3.05),new THREE.Vector3(6.7,0,3.05),new THREE.Vector3(-6.7,0,-3.05),new THREE.Vector3(6.7,0,-3.05),new THREE.Vector3(-6.7,0,-2.59),new THREE.Vector3(6.7,0,-2.59),new THREE.Vector3(-6.7,0,0),new THREE.Vector3(-1.98,0,0),new THREE.Vector3(6.7,0,0),new THREE.Vector3(1.98,0,0),new THREE.Vector3(-6.7,0,2.59),new THREE.Vector3(6.7,0,2.59),new THREE.Vector3(-6.7,0,3.05),new THREE.Vector3(6.7,0,3.05),new THREE.Vector3(0,
0,-3.05),new THREE.Vector3(0,1.55,-3.05),new THREE.Vector3(0,0,-2.59),new THREE.Vector3(0,1.55,-2.59),new THREE.Vector3(0,0,2.59),new THREE.Vector3(0,1.55,2.59),new THREE.Vector3(0,0,3.05),new THREE.Vector3(0,1.55,3.05));for(var d=0;d<c.vertices.length;d++)c.vertices[d].multiplyScalar(a);THREE.LineSegments.call(this,c,b);this.shuttle=null}function E(a,b,c){THREE.Object3D.call(this);this.parameters={width:a,height:b,font:c};a=new THREE.Mesh(new THREE.PlaneGeometry(a,b),new THREE.MeshBasicMaterial({side:THREE.DoubleSide}));
this.add(a);this.plane=a;this.textMesh=null}function K(a,b,c,d){THREE.Object3D.call(this);this.parameters={width:a,height:b,depth:c,cardGap:d};var f=Math.atan(c/2/b),e=Math.sqrt(Math.pow(c/2,2)+Math.pow(b,2)),h=new THREE.Mesh(new THREE.PlaneGeometry(a,e),new THREE.MeshNormalMaterial({side:THREE.DoubleSide}));h.position.y=b/2;h.position.z=c/4;h.rotation.x=-f;this.add(h);h=new THREE.Mesh(new THREE.PlaneGeometry(a,e),new THREE.MeshNormalMaterial({side:THREE.DoubleSide}));h.position.y=b/2;h.position.z=
-c/4;h.rotation.x=f;this.add(h);c=new THREE.Mesh(new THREE.PlaneGeometry(a,c),new THREE.MeshNormalMaterial({side:THREE.DoubleSide}));c.rotation.x=Math.PI/2;this.add(c);var g=e-2*d,n=(a-5*d)/3,l=new THREE.Object3D;l.position.y=1.01*b;this.add(l);var p=[1.5*-d-1.25*n,1.5*-d-1*n,1.5*-d-.75*n,.5*-d-.25*n,.5*+d+.25*n,1.5*+d+.75*n,1.5*+d+1*n,1.5*+d+1.25*n];for(a=0;a<p.length;a++)b=new THREE.Mesh(new THREE.TorusGeometry(15,1,16,16),new THREE.MeshNormalMaterial({side:THREE.DoubleSide})),b.position.x=p[a],
b.rotation.y=Math.PI/2,l.add(b);var k=this;(new THREE.FontLoader).load("https://ikatyang.github.io/three.badminton.js/fonts/gentilis_regular.typeface.json",function(a){function b(c,e,f,h,k){var p=new E(n*e,g*e,a);p.setText(c);p.position.x=f;p.rotation.x=h;p.visible=k;p.plane.position.y=-g*e/2-d;l.add(p);return p}k.frontCards=[k.frontCard1=b("0",1,p[1],2*Math.PI-f,!0),k.frontSmallCard1=b("0",.5,p[3],2*Math.PI-f,!0),k.frontSmallCard2=b("0",.5,p[4],2*Math.PI-f,!0),k.frontCard2=b("0",1,p[6],2*Math.PI-
f,!0)];k.backCards=[k.backCard1=b(null,1,p[1],f,!0),k.backSmallCard1=b(null,.5,p[3],f,!0),k.backSmallCard2=b(null,.5,p[4],f,!0),k.backCard2=b(null,1,p[6],f,!0)];k.animateCards=[k.animateCard1=b(null,1,p[1],0,!1),k.animateSmallCard1=b(null,.5,p[3],0,!1),k.animateSmallCard2=b(null,.5,p[4],0,!1),k.animateCard2=b(null,1,p[6],0,!1)]});this.speed=2*Math.PI;this.actions=[null,null,null,null]}function L(a,b){THREE.Object3D.call(this);this.parameters={radius:a,tube:b};var c=new THREE.Mesh(new THREE.TorusGeometry(a,
b,16,12),new THREE.MeshNormalMaterial);c.rotation.x=Math.PI/2;this.add(c);var d=new THREE.Geometry;d.vertices.push(new THREE.Vector3(-.5,2,0),new THREE.Vector3(.5,2,0),new THREE.Vector3(-.5,1,0),new THREE.Vector3(.5,1,0),new THREE.Vector3(-1,1,0),new THREE.Vector3(1,1,0),new THREE.Vector3(0,0,0));d.faces.push(new THREE.Face3(3,0,2),new THREE.Face3(3,1,0),new THREE.Face3(6,5,4));d.computeBoundingSphere();d.computeFaceNormals();d.computeVertexNormals();d=new THREE.Mesh(d,new THREE.MeshNormalMaterial);
d.scale.set(a,a,a);d.position.y=1.5*a;this.add(d);this.ring=c;this.arrow=d;this.arrowDir=-1;this.arrowMinY=a;this.arrowMaxY=2*a;this.arrowSpeed=2*a}function M(a,b,c){this.court=a;this.shuttle=b;this.score2=this.score1=this.nthScore=0;this.lastWinner=void 0!==c?c:1;this.scoreboard=null}window.performance=window.performance||Date;void 0===THREE.Object3D.prototype.directionLocalToWorld&&(THREE.Object3D.prototype.directionLocalToWorld=function(a){var b=this.localToWorld(new THREE.Vector3(0,0,0));return this.localToWorld(a).sub(b)});
void 0===THREE.Object3D.prototype.directionWorldToLocal&&(THREE.Object3D.prototype.directionWorldToLocal=function(a){var b=this.localToWorld(new THREE.Vector3(0,0,0));return this.worldToLocal(a.add(b))});void 0===THREE.Object3D.prototype.localToTarget&&(THREE.Object3D.prototype.localToTarget=function(a,b){return b.worldToLocal(this.localToWorld(a))});y.prototype=Object.create(THREE.Geometry.prototype);y.prototype.constructor=y;F.prototype=Object.defineProperties(Object.assign(Object.create(THREE.Object3D.prototype),
{constructor:F,getYAxis:function(){this.flipFrame.updateMatrixWorld();return this.flipFrame.directionLocalToWorld(new THREE.Vector3(0,1,0)).normalize()},impact:function(a,b,c,d){this.velocity.reflect(b).multiplyScalar(1-c).add(a);b=this.getYAxis();this.updateMove(0);this.updateMatrixWorld();a=this.directionWorldToLocal(this.velocity.clone().cross(b)).normalize();this.flipAngle=b=this.velocity.angleTo(b);this.flipAngularVelocity=0;this.flipAxis=a;a=(new THREE.Matrix4).makeRotationAxis(a,b);this.flipFrame.rotation.setFromRotationMatrix(a);
!1!==d&&this.impactCount++},update:function(a){"move"===this.state?(this.updateMove(a),0>this.position.y&&(this.impact(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0),this.groundAttenuation,!1),0>this.velocity.y&&(this.state="topple"))):"topple"===this.state&&this.updateTopple(a);this.lastDelta=a},updateMove:function(a){var b=this.airDensity,c=this.parameters.skirtCrossSectionalArea,d=this.dragCoefficient,f=this.velocity.length(),b=b*c*d*f*f/2,b=this.velocity.clone().normalize().multiplyScalar(-b),
b=this.gravity.clone().multiplyScalar(this.parameters.mass).add(b);this.velocity.addScaledVector(b,a/this.parameters.mass);this.position.addScaledVector(this.velocity,a);b=this.velocity.clone().cross(this.gravity).normalize();0<b.length()&&(c=this.velocity.clone().normalize(),d=b.clone().cross(c).normalize(),b=(new THREE.Matrix4).makeBasis(b,c,d),this.rotation.setFromRotationMatrix(b));0<a&&(b=[this.flipAngle,this.flipAngularVelocity],this.solveODE(b,this.flipDerivative,a),this.flipAngle=b[0],this.flipAngularVelocity=
b[1],Math.abs(this.flipAngle)<Math.PI?(a=(new THREE.Matrix4).makeRotationAxis(this.flipAxis,this.flipAngle),this.flipFrame.rotation.setFromRotationMatrix(a)):this.flipFrame.rotation.set(0,0,0))},updateTopple:function(a){this.rotation.setFromRotationMatrix((new THREE.Matrix4).makeRotationFromEuler(this.rotation).multiply((new THREE.Matrix4).makeRotationFromEuler(this.flipFrame.rotation)));this.flipFrame.rotation.set(0,0,0);this.flipAngle=0;var b=this.getYAxis(),c=this.velocity.clone().setY(0).normalize();
b.clone().negate().angleTo(c)>Math.PI/2&&c.negate();var d=this.directionWorldToLocal(b.clone().negate().cross(c)).normalize();a=Math.min(this.stopAngularVelocity*a,b.clone().negate().angleTo(c)-this.parameters.corkAngle);b=(new THREE.Matrix4).makeRotationFromEuler(this.rotation);this.rotation.setFromRotationMatrix(b.multiply((new THREE.Matrix4).makeRotationAxis(d,a)));this.position.y-=this.localToTarget(new THREE.Vector3(0,this.parameters.massToCorkTopLength,0),this.parent).y;1E-4>a&&(this.state=
"stop-ground")},flipDerivative:function(a){var b=a[0];a=a[1];var c=this.airDensity,d=this.dragCoefficient,f=this.velocity.length(),e=this.parameters.skirtMass,h=this.parameters.corkMass,g=this.parameters.skirtCrossSectionalArea;return[a,-(c*g*d*f)/(2*e*(1+e/h))*a-c*g*d*f*f/(2*(h+e)*this.parameters.massToCorkCenterLength)*Math.sin(b)]},solveODE:function(a,b,c){for(var d=a.slice(0),d=b.call(this,d),f=a.slice(0),e=0;e<a.length;e++)f[e]+=c/2*d[e];for(var f=b.call(this,f),h=a.slice(0),e=0;e<a.length;e++)h[e]+=
c/2*f[e];for(var h=b.call(this,h),g=a.slice(0),e=0;e<a.length;e++)g[e]+=h[e]*c;b=b.call(this,g);for(e=0;e<a.length;e++)a[e]+=(d[e]+2*f[e]+2*h[e]+b[e])/6*c;return a}}),{airDensity:{get:function(){return this._airDensity/Math.pow(this.meter2unit,3)},set:function(a){this._airDensity=a}},gravity:{get:function(){return this._gravity.clone().multiplyScalar(this.meter2unit)},set:function(a){this._gravity=a}}});I.prototype=Object.defineProperties(Object.assign(Object.create(THREE.Object3D.prototype),{constructor:I,
setImpactAudio:function(a,b){this.impactAudio=a;this.camera=b},reset:function(){this.topLink.rotation.set(0,0,0);this.leftLink.rotation.set(0,0,0);this.rightLink.rotation.set(0,0,0);this.impactCount=0;this.healthPercent=100},setLimits:function(a,b){this.limits=a;!0===b&&this.position.set((a.xMin+a.xMax)/2,0,(a.zMin+a.zMax)/2)},predictFallingTime:function(a){return(a-this.shuttle.position.y)/this.shuttle.velocity.y},predictFallingPosition:function(a){var b=this.predictFallingTime(a);return-.01>b?null:
this.shuttle.position.clone().addScaledVector(this.shuttle.velocity,b).add(this.shuttle.position).divideScalar(2).setY(a)},update:function(a){this.onBeforeUpdate();var b,c,d,f,e,h,g,n;if("smash"===this.impactType){f=this.targetPosition;var l=new THREE.Vector3(0,this.netHeight+this.netHeightDelta,1);c=new THREE.Vector3(0,this.netHeight+this.netHeightDelta,-1);l=l.clone().sub(f);c=c.clone().sub(f);l=l.clone().cross(c);c=this.shuttle.velocity;d=this.shuttle.position;l=f.clone().sub(d).dot(l)/c.clone().dot(l);
g=c.clone().multiplyScalar(l).add(d);c=this.topLink;d=this.topRacket;f=Math.PI/2-g.clone().sub(f).angleTo(new THREE.Vector3(0,1,0));e=this.smashSpeed;b=-1E4<l?g:null;h=g.y;g=this.parameters.racketLength/2;n=new THREE.Vector3(0,this.parameters.bodyHeight+this.parameters.racketLength/2*Math.cos(f),this.parameters.racketLength/2*Math.sin(f));"common"===this.eyeStatus&&(this.body.remove(this.eyes),this.body.add(this.smashEyes),this.eyeStatus="smash")}else"top"===this.impactType?(c=this.topLink,d=this.topRacket,
f=this.topImpactAngle,g=this.parameters.racketLength/2,n=new THREE.Vector3(0,this.parameters.bodyHeight+this.parameters.racketLength/2*Math.cos(f),this.parameters.racketLength/2*Math.sin(f)),h=n.y,e=this.getTopImpactSpeed(h)):("left"===this.impactType?(c=this.leftLink,d=this.leftRacket,h=this.leftImpactHeight,g=this.leftImpactWidth,n=new THREE.Vector3(this.leftImpactWidth,this.leftImpactHeight,0)):"right"===this.impactType&&(c=this.rightLink,d=this.rightRacket,h=this.rightImpactHeight,g=this.rightImpactWidth,
n=new THREE.Vector3(-this.rightImpactWidth,this.rightImpactHeight,0)),l=this.getImpactParams(h),f=l[0],e=l[1]),b=this.predictFallingPosition(h),"smash"===this.eyeStatus&&(this.body.remove(this.smashEyes),this.body.add(this.eyes),this.eyeStatus="common");"common"===this.eyeStatus&&(l=this.body.worldToLocal(this.shuttle.localToWorld(new THREE.Vector3)),5<l.x?(this.leftEyeBall.position.x=this.side/2-.3*this.side/2,this.rightEyeBall.position.x=this.side/2-.3*this.side/2):-5>l.x?(this.leftEyeBall.position.x=
-(this.side/2-.3*this.side/2),this.rightEyeBall.position.x=-(this.side/2-.3*this.side/2)):(this.leftEyeBall.position.x=0,this.rightEyeBall.position.x=0));0!==this.impactCount&&this.shuttle.impactCount!==this.impactCount+1||"stop-ground"===this.shuttle.state||"stop-net"===this.shuttle.state||!b||0===this.limits.xMin&&0>b.x||0===this.limits.xMax&&0<b.x||b.x<this.limits.xMin+(this.limits.xMin-this.limits.xMax)*this.limitEpsilon||b.x>this.limits.xMax+(this.limits.xMax-this.limits.xMin)*this.limitEpsilon||
b.z<this.limits.zMin+(this.limits.zMin-this.limits.zMax)*this.limitEpsilon||b.z>this.limits.zMax+(this.limits.zMax-this.limits.zMin)*this.limitEpsilon?(h=f=l=0,b=new THREE.Vector3((this.limits.xMin+this.limits.xMax)/2,0,(this.limits.zMin+this.limits.zMax)/2)):(l=this.directionWorldToLocal(this.targetPosition.clone().sub(b).setY(0)),l=l.angleTo(new THREE.Vector3(0,0,1))*(0>l.x?-1:1),n=this.body.directionLocalToWorld(n.clone()),b=b.clone().sub(n),h=this.predictFallingTime(h),n=Math.PI/e,h=0>h||h>n?
0:h<n/2?THREE.Math.clamp(h*e,0,Math.PI):THREE.Math.clamp(Math.PI/2-(h-n/2)*e,0,Math.PI));c.angleB=0;c.updateMatrixWorld();this.checkIntersect(d,this.shuttle)&&this.impactClock.getDelta()>this.impactDelta&&(d=c.directionLocalToWorld(new THREE.Vector3(0,0,1)).normalize(),this.shuttle.impact(d.clone().multiplyScalar(e*g),d,this.racketAttenuation),this.impactCount=this.shuttle.impactCount,this.healthPercent*=this.healthAttenuation,this.impactAudio&&this.camera&&(d=this.localToWorld(new THREE.Vector3(0,
0,0)).sub(this.camera.localToWorld(new THREE.Vector3(0,0,0))).length(),this.impactAudio.currentTime=0,this.impactAudio.volume=1-Math.abs(d/this.camera.far),this.impactAudio.play()),this.onAfterImpact());c.angleB=h;f-=c.angleA;d=this.linkAngularSpeed*a*(0>f?-1:1);c.angleA+=Math.abs(f)<Math.abs(d)?f:d;c=b.clone().sub(this.position);f=c.clone().setLength(this.healthPercent/100*a*this.bodySpeed);c=c.length()<f.length()?c:f;this.position.add(c);c=l-this.body.rotation.y;a=this.bodyAngularSpeed*a*(0>c?-1:
1);this.body.rotation.y+=Math.abs(c)<Math.abs(a)?c:a},checkIntersect:function(a,b){a.updateMatrixWorld();b.updateMatrixWorld();null===b.geometry.boundingSphere&&b.geometry.computeBoundingSphere();null===a.geometry.boundingBox&&a.geometry.computeBoundingBox();var c=b.localToTarget(b.geometry.boundingSphere.center.clone(),this.parent),d=c.clone().addScaledVector(this.shuttle.velocity,-this.shuttle.lastDelta);this.parent.localToTarget(c,a);this.parent.localToTarget(d,a);var f=!1,e=d.clone().sub(c),d=
-c.z/e.z;if(1>=Math.abs(d)||0>d*this.lastCheckMul)c=c.clone().addScaledVector(e,d),f=this.checkIntersectPlaneAndCircle({min:{x:a.geometry.boundingBox.min.x-c.x,y:a.geometry.boundingBox.min.y-c.y},max:{x:a.geometry.boundingBox.max.x-c.x,y:a.geometry.boundingBox.max.y-c.y}},b.geometry.boundingSphere.radius),this.lastCheckMul=d;return f},checkIntersectPlaneAndCircle:function(a,b){return 0>a.max.x?0>a.max.y?a.max.x*a.max.x+a.max.y*a.max.y<b*b:0<a.min.y?a.max.x*a.max.x+a.min.y*a.min.y<b*b:Math.abs(a.max.x)<
b:0<a.min.x?0>a.max.y?a.min.x*a.min.x+a.max.y*a.max.y<b*b:0<a.min.y?a.min.x*a.min.x+a.min.y*a.min.y<b*b:Math.abs(a.min.x)<b:0>a.max.y?Math.abs(a.max.y)<b:0<a.min.y?Math.abs(a.min.y)<b:!0},getTopImpactSpeed:function(a){var b=this.shuttle.position.clone().setY(0),c=this.targetPosition.clone().sub(b);a=c.clone().length();b=Math.abs(b.clone().distanceTo(c));b=Math.ceil(b/100)-2;for(0>b&&(b=0);b<this.topForceTable.length&&!(this.topForceTable[b][0]>a);b++);0!==b&&b--;return Math.PI*this.topForceTable[b][1]},
getImpactParams:function(a){var b=this.hitAngleSpeed();return[Math.atan((this.netHeight-a)/(b[0]*b[2])),Math.PI*b[1]]},hitAngleSpeed:function(){var a=this.forceTable,b,c;b=this.shuttle.position.clone().setY(0);var d=this.targetPosition.clone().sub(b).length();c=Math.abs(b.x);for(b=0;b<a.length&&!(c<a[b][0]);b++);0!==b&&b--;for(c=1;c<a[b].length&&!(d<a[b][c][0]);c++);return 1===c?(d=this.searchNearTable(b,d),[a[b][0],d[0],d[1]]):[a[b][0],c===a[b].length?a[b][c-1][1]:a[b][c-1][1]+.8*(d-a[b][c-1][0])/
(a[b][c][0]-a[b][c-1][0])*(a[b][c][1]-a[b][c-1][1]),.5]},searchNearTable:function(a,b){for(var c=this.nearForceTable,d=0;d<c[a].length&&!(b<c[a][d][0]);d++);if(d!==c[a].length&&0!==d)return b-c[a][d-1][0]<c[a][d][0]-b?[c[a][d-1][1],c[a][d-1][2]]:[c[a][d][1],c[a][d][2]];0!==d&&d--;return[c[a][d][1],c[a][d][2]]},forceTable:[[50,[137.985,4],[171.764,5],[181.607,5.5],[196.202,6],[210.167,6.5]],[60,[199.854,5],[227.5,6],[257.592,7],[287.615,8]],[100,[275.066,5],[324.661,6],[361.542,7],[390.883,8],[424.454,
9],[453.068,10],[502.904,12],[522.702,13],[564.443,15]],[200,[410.093,6],[458.291,7],[507.016,8],[559.387,9],[592.505,10],[665.365,12],[699.139,13],[722.29,14],[747.837,15],[799.139,17],[821.3,18],[836.071,19]],[300,[534.076,8],[592.751,9],[614.948,10],[691.248,12],[734.713,13],[756.567,14],[792.024,15],[872.006,18],[906.458,20],[947.016,22],[964.18,23],[981.645,24]],[400,[688.696,12],[719.63,13],[723.163,14],[756.823,15],[778.991,16],[825.065,18],[869.899,20],[907.816,22],[968.375,25],[985.026,28],
[1026.356,30],[1045.12,32],[1082.599,35]],[500,[799.488,16],[841.45,18],[887.547,20],[910.274,22],[952.236,25],[993.63,28],[1016.415,30],[1043.966,33],[1069.137,35],[1084.272,38],[1102.328,45],[1125.554,50]],[600,[832.078,18],[870.521,20],[918.2,23],[945.298,25],[1001.864,30],[1047.207,35],[1085.517,40],[1120.521,45],[1142.557,50],[1159.886,55],[1179.336,60],[1183.502,65]],[670,[919.055,25],[976.644,30],[1022.786,35],[1060.423,40],[1096.539,45],[1126.575,50],[1140.54,55],[1155.065,60],[1160.136,65],
[1165.34,70],[1185.009,75]]],nearForceTable:[[[116.17,4,.5],[133.989,4,.6]],[[110.709,4,.4],[133.989,4,.5],[155.276,4,.6]],[[171.218,4,.4],[197.541,4,.5],[211.025,5,.4],[220.771,4,.6],[247.074,5,.5],[274.574,5,.6]],[[316.081,5,.4],[361.806,5,.6],[417.773,6,.6]],[[417.841,6,.4],[439.847,6,.5],[473.036,7,.4],[504.056,7,.6]],[[551.695,9,.4],[597.663,10,.6],[633.222,11,.6]],[[684.329,12,.5],[706.157,13,.6],[749.17,14,.3],[762.856,14,.5]],[[666.356,12,.2],[730.342,13,.4],[748.811,14,.5]],[[838.084,19,
.4],[842.727,20,.6],[860.917,21,.6]]],topForceTable:[[432.837,12],[508.317,15],[612.811,20],[697.075,25],[767.586,30],[793.203,32],[829.48,35],[849.617,37],[860.173,38],[880.123,40],[925.701,45],[966.793,50],[1002.28,55],[1036.857,60],[1064.451,65],[1091.885,70],[1118.193,75],[1140.245,80],[1160.976,85],[1182.143,90],[1200.124,95],[1217.301,100],[1233.056,105],[1248.758,110],[1261.102,115],[1274.775,120],[1287.784,125],[1298.189,130],[1309.88,135],[1321.354,140],[1329.665,145],[1333.054,150]],topTableStart:[0,
1,2,3,5,6],onAfterImpact:function(){},onBeforeUpdate:function(){}}),{netHeight:{get:function(){return this._netHeight*this.shuttle.meter2unit},set:function(a){this._netHeight=a}},netHeightDelta:{get:function(){return this._netHeightDelta*this.shuttle.meter2unit},set:function(a){this._netHeightDelta=a}}});J.prototype=Object.assign(Object.create(THREE.LineSegments.prototype),{constructor:J,reset:function(){this.lastUpdateMul=0},update:function(a){var b=this.shuttle.localToTarget(new THREE.Vector3(0,
0,0),this),c=this.shuttle.localToTarget(this.shuttle.velocity.clone().multiplyScalar(-this.shuttle.lastDelta),this).clone().sub(b);a=-b.x/c.x;b=b.clone().addScaledVector(c,a);(1>=Math.abs(a)||0>a*this.lastUpdateMul)&&0<=b.y&&b.y<=1.55*this.parameters.meter2unit&&b.z>=-3.05*this.parameters.meter2unit&&b.z<=3.05*this.parameters.meter2unit&&(this.shuttle.state="stop-net",this.shuttle.position.copy(this.localToTarget(b.clone(),this.shuttle.parent)));this.lastUpdateMul=a},getArea:function(){return{xMin:-6.7*
this.parameters.meter2unit,xMax:6.7*this.parameters.meter2unit,zMin:-2.59*this.parameters.meter2unit,zMax:2.59*this.parameters.meter2unit}},getArea1:function(){return{xMin:-6.7*this.parameters.meter2unit,xMax:0*this.parameters.meter2unit,zMin:-2.59*this.parameters.meter2unit,zMax:2.59*this.parameters.meter2unit}},getArea2:function(){return{xMin:0*this.parameters.meter2unit,xMax:6.7*this.parameters.meter2unit,zMin:-2.59*this.parameters.meter2unit,zMax:2.59*this.parameters.meter2unit}},getFirstArea1:function(a){return 1===
a%2?{xMin:-6.7*this.parameters.meter2unit,xMax:-1.98*this.parameters.meter2unit,zMin:-2.59*this.parameters.meter2unit,zMax:0*this.parameters.meter2unit}:{xMin:-6.7*this.parameters.meter2unit,xMax:-1.98*this.parameters.meter2unit,zMin:0*this.parameters.meter2unit,zMax:2.59*this.parameters.meter2unit}},getFirstArea2:function(a){return 1===a%2?{xMin:1.98*this.parameters.meter2unit,xMax:6.7*this.parameters.meter2unit,zMin:0*this.parameters.meter2unit,zMax:2.59*this.parameters.meter2unit}:{xMin:1.98*this.parameters.meter2unit,
xMax:6.7*this.parameters.meter2unit,zMin:-2.59*this.parameters.meter2unit,zMax:0*this.parameters.meter2unit}}});E.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:E,setText:function(a){this.text=a;this.textMesh&&(this.plane.remove(this.textMesh),this.textMesh=null);null!==a&&(a=new THREE.Mesh(new THREE.TextGeometry(a,{font:this.parameters.font,height:.1}),new THREE.MeshNormalMaterial),a.geometry.computeBoundingBox(),a.scale.set(.8*this.parameters.width/(a.geometry.boundingBox.max.x-
a.geometry.boundingBox.min.x),.8*this.parameters.height/(a.geometry.boundingBox.max.y-a.geometry.boundingBox.min.y),1),a.position.x=-.45*this.parameters.width,a.position.y=-.45*this.parameters.height,a.position.z=.1,this.plane.add(a),this.textMesh=a)}});K.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:K,setCardAction:function(a,b,c){var d=this.frontCards[a],f=this.backCards[a],e=this.animateCards[a];"next"===c?(e.setText(b),e.rotation.x=f.rotation.x,e.visible=!0):(e.setText(d.text),
e.rotation.x=d.rotation.x,e.visible=!0,d.setText(b));this.actions[a]={text:b,cardNo:a,direction:c,frontCard:d,backCard:f,animateCard:e}},update:function(a){for(var b=0;b<this.actions.length;b++)null!==this.actions[b]&&this.updateCard(a,this.actions[b])},updateCard:function(a,b){var c="next"===b.direction?b.frontCard:b.backCard,d=c.rotation.x-b.animateCard.rotation.x,f=this.speed*a*(0>d?-1:1);b.animateCard.rotation.x+=Math.abs(d)<Math.abs(f)?d:f;b.animateCard.rotation.x===c.rotation.x&&("next"===b.direction&&
b.frontCard.setText(b.text),b.animateCard.visible=!1,this.actions[b.cardNo]=null)}});L.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:L,update:function(a,b){this.lookAt(b.position.clone().setY(this.localToWorld(new THREE.Vector3(0,0,0)).y));0<this.arrowDir?(this.arrow.position.y+=this.arrowSpeed*a,this.arrow.position.y>this.arrowMaxY&&(this.arrow.position.y=this.arrowMaxY,this.arrowDir*=-1)):(this.arrow.position.y-=this.arrowSpeed*a,this.arrow.position.y<this.arrowMinY&&
(this.arrow.position.y=this.arrowMinY,this.arrowDir*=-1))}});M.prototype={constructor:M,get lastWinnerScore(){return this["score"+this.lastWinner]},set lastWinnerScore(a){this["score"+this.lastWinner]=a},nextScore:function(){this.nthScore++;this.shuttle.impactCount=0;this.shuttle.state="move"},update:function(a){if(this.nthScore!==this.score1+this.score2)if("stop-net"===this.shuttle.state)this.lastWinner=0===this.shuttle.impactCount%2?this.lastWinner:this.lastWinner%2+1,this.lastWinnerScore++,this.updateScoreboard(),
this.onScoreChange();else if("stop-ground"===this.shuttle.state){a=1>=this.shuttle.impactCount?1===this.lastWinner?this.court.getFirstArea2(this.score1):this.court.getFirstArea1(this.score2):1===this.lastWinner?1===this.shuttle.impactCount%2?this.court.getArea2():this.court.getArea1():1===this.shuttle.impactCount%2?this.court.getArea1():this.court.getArea2();var b=this.shuttle.localToTarget(new THREE.Vector3(0,0,0),this.court);this.lastWinner=b.x>=a.xMin&&b.x<=a.xMax&&b.z>=a.zMin&&b.z<=a.zMax?1===
this.shuttle.impactCount%2?this.lastWinner:this.lastWinner%2+1:0===this.shuttle.impactCount%2?this.lastWinner:this.lastWinner%2+1;this.lastWinnerScore++;this.updateScoreboard();this.onScoreChange()}},updateScoreboard:function(){this.scoreboard&&(1===this.lastWinner?this.scoreboard.setCardAction(0,this.score1.toString(),"next"):this.scoreboard.setCardAction(3,this.score2.toString(),"next"))},onScoreChange:function(){}};t.ShuttlecockGeometry=y;t.Shuttlecock=F;t.Robot=I;t.Court=J;t.Scoreboard=K;t.ScoreboardCard=
E;t.TargetPoint=L;t.Game=M;Object.defineProperty(t,"__esModule",{value:!0})});
